!function(i){var a={};function n(t){var e;return(a[t]||(e=a[t]={i:t,l:!1,exports:{}},i[t].call(e.exports,e,e.exports,n),e.l=!0,e)).exports}n.m=i,n.c=a,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="js/",n(n.s=0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t},n=s(i(1)),o=s(i(2));function r(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function s(t){return t&&t.__esModule?t:{default:t}}var l=new(s(i(3)).default.GyroNorm),i=(a(c,[{key:"addShader",value:function(t,e){e=this.gl.createShader(e);if(this.gl.shaderSource(e,t),this.gl.compileShader(e),!this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS))throw new Error("Shader compile error: "+this.gl.getShaderInfoLog(e));this.gl.attachShader(this.program,e)}},{key:"resizeHandler",value:function(){this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.canvas.width=this.width*this.ratio,this.canvas.height=this.height*this.ratio,this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px";var t=void 0,e=void 0,e=this.height/this.width<this.imageAspect?(t=1,this.height/this.width/this.imageAspect):(t=this.width/this.height*this.imageAspect,1);this.uResolution.set(this.width,this.height,t,e),this.uRatio.set(1/this.ratio),this.uThreshold.set(this.hth,this.vth),this.gl.viewport(0,0,this.width*this.ratio,this.height*this.ratio)}},{key:"resize",value:function(){this.resizeHandler(),window.addEventListener("resize",this.resizeHandler.bind(this))}},{key:"createScene",value:function(){this.program=this.gl.createProgram(),this.addShader(o.default,this.gl.VERTEX_SHADER),this.addShader(n.default,this.gl.FRAGMENT_SHADER),this.gl.linkProgram(this.program),this.gl.useProgram(this.program),this.uResolution=new h("resolution","4f",this.program,this.gl),this.uMouse=new h("mouse","2f",this.program,this.gl),this.uTime=new h("time","1f",this.program,this.gl),this.uRatio=new h("pixelRatio","1f",this.program,this.gl),this.uThreshold=new h("threshold","2f",this.program,this.gl),this.billboard=new u(this.gl),this.positionLocation=this.gl.getAttribLocation(this.program,"a_position"),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0)}},{key:"addTexture",value:function(){this.gl;for(var t,e,i=this.imageURLs,a=this.start.bind(this),n=[],o=i.length,r=function(){0==--o&&a(n)},s=0;s<o;++s){l=i[s],t=r,e=void 0,(e=new Image).src=l,e.onload=t;var l=e;n.push(l)}}},{key:"start",value:function(t){var e=this.gl;this.imageAspect=t[0].naturalHeight/t[0].naturalWidth,console.log(this.imageAspect,"=aspect",this);for(var i=0;i<t.length;i++){var a=e.createTexture();e.bindTexture(e.TEXTURE_2D,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t[i]),this.textures.push(a)}var n=this.gl.getUniformLocation(this.program,"image0"),o=this.gl.getUniformLocation(this.program,"image1");this.gl.uniform1i(n,0),this.gl.uniform1i(o,1),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[0]),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[1]),this.resize(),this.render()}},{key:"gyro",value:function(){var i=this;this.maxTilt=15,l.init({gravityNormalized:!0}).then(function(){l.start(function(t){var e=t.do.gamma,t=t.do.beta;i.mouseTargetY=m(t,-i.maxTilt,i.maxTilt)/i.maxTilt,i.mouseTargetX=-m(e,-i.maxTilt,i.maxTilt)/i.maxTilt})}).catch(function(t){console.log("not supported")})}},{key:"mouseMove",value:function(){var a=this;document.addEventListener("mousemove",function(t){var e=a.windowWidth/2,i=a.windowHeight/2;a.mouseTargetX=(e-t.clientX)/e,a.mouseTargetY=(i-t.clientY)/i})}},{key:"render",value:function(){var t=((new Date).getTime()-this.startTime)/1e3;this.uTime.set(t),this.mouseX+=.05*(this.mouseTargetX-this.mouseX),this.mouseY+=.05*(this.mouseTargetY-this.mouseY),this.uMouse.set(this.mouseX,this.mouseY),this.billboard.render(this.gl),requestAnimationFrame(this.render.bind(this))}}]),c);function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.container=document.getElementById("gl"),this.canvas=document.createElement("canvas"),this.container.appendChild(this.canvas),this.gl=this.canvas.getContext("webgl"),this.ratio=window.devicePixelRatio,this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.mouseX=0,this.mouseY=0,this.mouseTargetX=0,this.mouseTargetY=0,this.imageOriginal=this.container.getAttribute("data-imageOriginal"),this.imageDepth=this.container.getAttribute("data-imageDepth"),this.vth=this.container.getAttribute("data-verticalThreshold"),this.hth=this.container.getAttribute("data-horizontalThreshold"),this.imageURLs=[this.imageOriginal,this.imageDepth],this.textures=[],this.startTime=(new Date).getTime(),this.createScene(),this.addTexture(),this.mouseMove(),this.gyro()}function h(t,e,i,a){this.name=t,this.suffix=e,this.gl=a,this.program=i,this.location=a.getUniformLocation(i,t)}function u(t){var e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,u.verts,t.STATIC_DRAW)}function m(t,e,i){return t=t==t&&(void 0!==i&&(t=t<=i?t:i),void 0!==e)?e<=t?t:e:t}e.default=i,h.prototype.set=function(){for(var t="uniform"+this.suffix,e=arguments.length,i=Array(e),a=0;a<e;a++)i[a]=arguments[a];var n=[this.location].concat(i);this.gl[t].apply(this.gl,n)},u.verts=new Float32Array([-1,-1,1,-1,-1,1,1,1]),u.prototype.render=function(t){t.drawArrays(t.TRIANGLE_STRIP,0,4)},new i},function(t,e){t.exports="#ifdef GL_ES\n  precision mediump float;\n#define GLSLIFY 1\n#endif\n\nuniform vec4 resolution;\nuniform vec2 mouse;\nuniform vec2 threshold;\nuniform float time;\nuniform float pixelRatio;\nuniform sampler2D image0;\nuniform sampler2D image1;\n\n\nvec2 mirrored(vec2 v) {\n  vec2 m = mod(v,2.);\n  return mix(m,2.0 - m, step(1.0 ,m));\n}\n\nvoid main() {\n  // uvs and textures\n  vec2 uv = pixelRatio*gl_FragCoord.xy / resolution.xy ;\n  vec2 vUv = (uv - vec2(0.5))*resolution.zw + vec2(0.5);\n  vUv.y = 1. - vUv.y;\n  vec4 tex1 = texture2D(image1,mirrored(vUv));\n  // tex1.r = 1. - tex1.r;\n  // tex1.r = tex1.r*tex1.r;\n  vec2 fake3d = vec2(vUv.x + (tex1.r - 0.5)*mouse.x/threshold.x, vUv.y + (tex1.r - 0.5)*mouse.y/threshold.y);\n  vec4 tex0 = texture2D(image0,mirrored(fake3d));\n  \n\n\n  gl_FragColor = vec4(uv,0.,1.);\n  gl_FragColor = tex0;\n}"},function(t,e){t.exports="#define GLSLIFY 1\nattribute vec2 a_position;\n\nvoid main() {\n  gl_Position = vec4( a_position, 0, 1 );\n}"},function(N,S,U){"use strict";var X,Y,k,P,j,B,t,Q,r,e,i,s,l,Z,c,h,a,n,u,o,m,d,H,x,g,v,p,f,y,A,b,W,E,V,q,J,K,$,T,R,tt,w,et,it,_,M,I,at,L,O,z,G,nt,ot,D,rt,st;function F(t){return Math.round(t*Math.pow(10,a))/Math.pow(10,a)}function lt(t){n&&n(t="string"==typeof t?{message:t,code:0}:t)}function C(t){}function ct(t){return 0==(t=+t)||isNaN(t)?t:0<t?1:-1}function ht(n){return new Promise(function(i,a){!function t(e){setTimeout(function(){n&&n.data?i():20<=e?a():t(++e)},50)}(0)})}function ut(){f=p?(o.screen.orientation.angle||0)*x:(o.orientation||0)*x}function mt(t){for(var e in v.orientation.data=t,v.orientation.callbacks)v.orientation.callbacks[e].call(this)}function dt(t){for(var e in v.motion.data=t,v.motion.callbacks)v.motion.callbacks[e].call(this)}void 0!==(o=window).FULLTILT&&null!==o.FULLTILT||(m=Math.PI,g=180/m,v={orientation:{active:!1,callbacks:[],data:void 0},motion:{active:!1,callbacks:[],data:void 0}},p=!(!o.screen||!o.screen.orientation||void 0===o.screen.orientation.angle||null===o.screen.orientation.angle),f=(p?o.screen.orientation.angle:o.orientation||0)*(x=m/180),b=(H=2*(A=m))/3,W=-(y=d=m/2),(E={version:"0.5.3",getDeviceOrientation:function(a){return new Promise(function(t,e){var i=new E.DeviceOrientation(a);i.start(),new ht(v.orientation).then(function(){i._alphaAvailable=v.orientation.data.alpha&&null!==v.orientation.data.alpha,i._betaAvailable=v.orientation.data.beta&&null!==v.orientation.data.beta,i._gammaAvailable=v.orientation.data.gamma&&null!==v.orientation.data.gamma,t(i)}).catch(function(){i.stop(),e("DeviceOrientation is not supported")})})},getDeviceMotion:function(a){return new Promise(function(t,e){var i=new E.DeviceMotion(a);i.start(),new ht(v.motion).then(function(){i._accelerationXAvailable=v.motion.data.acceleration&&v.motion.data.acceleration.x,i._accelerationYAvailable=v.motion.data.acceleration&&v.motion.data.acceleration.y,i._accelerationZAvailable=v.motion.data.acceleration&&v.motion.data.acceleration.z,i._accelerationIncludingGravityXAvailable=v.motion.data.accelerationIncludingGravity&&v.motion.data.accelerationIncludingGravity.x,i._accelerationIncludingGravityYAvailable=v.motion.data.accelerationIncludingGravity&&v.motion.data.accelerationIncludingGravity.y,i._accelerationIncludingGravityZAvailable=v.motion.data.accelerationIncludingGravity&&v.motion.data.accelerationIncludingGravity.z,i._rotationRateAlphaAvailable=v.motion.data.rotationRate&&v.motion.data.rotationRate.alpha,i._rotationRateBetaAvailable=v.motion.data.rotationRate&&v.motion.data.rotationRate.beta,i._rotationRateGammaAvailable=v.motion.data.rotationRate&&v.motion.data.rotationRate.gamma,t(i)}).catch(function(){i.stop(),e("DeviceMotion is not supported")})})},Quaternion:function(t,e,i,a){var n,o,r,s,l,c,h,u;this.set=function(t,e,i,a){this.x=t||0,this.y=e||0,this.z=i||0,this.w=a||1},this.copy=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},this.setFromEuler=function(t){return u=((t=t||{}).alpha||0)*x,c=(t.beta||0)*x,h=(t.gamma||0)*x,u=u/2,c=c/2,h=h/2,r=Math.cos(c),s=Math.cos(h),l=Math.cos(u),c=Math.sin(c),h=Math.sin(h),u=Math.sin(u),this.set(c*s*l-r*h*u,r*h*l+c*s*u,r*s*u+c*h*l,r*s*l-c*h*u),this.normalize(),this},this.setFromRotationMatrix=function(t){return o=t.elements,this.set(.5*Math.sqrt(1+o[0]-o[4]-o[8])*ct(o[7]-o[5]),.5*Math.sqrt(1-o[0]+o[4]-o[8])*ct(o[2]-o[6]),.5*Math.sqrt(1-o[0]-o[4]+o[8])*ct(o[3]-o[1]),.5*Math.sqrt(1+o[0]+o[4]+o[8])),this},this.multiply=function(t){return n=E.Quaternion.prototype.multiplyQuaternions(this,t),this.copy(n),this},this.rotateX=function(t){return n=E.Quaternion.prototype.rotateByAxisAngle(this,[1,0,0],t),this.copy(n),this},this.rotateY=function(t){return n=E.Quaternion.prototype.rotateByAxisAngle(this,[0,1,0],t),this.copy(n),this},this.rotateZ=function(t){return n=E.Quaternion.prototype.rotateByAxisAngle(this,[0,0,1],t),this.copy(n),this},this.normalize=function(){return E.Quaternion.prototype.normalize(this)},this.set(t,e,i,a)}}).Quaternion.prototype={constructor:E.Quaternion,multiplyQuaternions:(st=new E.Quaternion,function(t,e){var i=t.x,a=t.y,n=t.z,t=t.w,o=e.x,r=e.y,s=e.z,e=e.w;return st.set(i*e+t*o+a*s-n*r,a*e+t*r+n*o-i*s,n*e+t*s+i*r-a*o,t*e-i*o-a*r-n*s),st}),normalize:function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w);return 0===e?(t.x=0,t.y=0,t.z=0,t.w=1):(t.x*=e=1/e,t.y*=e,t.z*=e,t.w*=e),t},rotateByAxisAngle:(new E.Quaternion,rt=new E.Quaternion,function(t,e,i){return ot=(i||0)/2,D=Math.sin(ot),rt.set((e[0]||0)*D,(e[1]||0)*D,(e[2]||0)*D,Math.cos(ot)),D=E.Quaternion.prototype.multiplyQuaternions(t,rt),E.Quaternion.prototype.normalize(D)})},E.RotationMatrix=function(t,e,i,a,n,o,r,s,l){var c,h,u,m,d,g,v,p,f,y,A;this.elements=new Float32Array(9),this.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},this.set=function(t,e,i,a,n,o,r,s,l){this.elements[0]=t||1,this.elements[1]=e||0,this.elements[2]=i||0,this.elements[3]=a||0,this.elements[4]=n||1,this.elements[5]=o||0,this.elements[6]=r||0,this.elements[7]=s||0,this.elements[8]=l||1},this.copy=function(t){this.elements[0]=t.elements[0],this.elements[1]=t.elements[1],this.elements[2]=t.elements[2],this.elements[3]=t.elements[3],this.elements[4]=t.elements[4],this.elements[5]=t.elements[5],this.elements[6]=t.elements[6],this.elements[7]=t.elements[7],this.elements[8]=t.elements[8]},this.setFromEuler=function(t){return A=((t=t||{}).alpha||0)*x,f=(t.beta||0)*x,y=(t.gamma||0)*x,g=Math.cos(f),v=Math.cos(y),p=Math.cos(A),f=Math.sin(f),y=Math.sin(y),A=Math.sin(A),this.set(p*v-A*f*y,-g*A,v*A*f+p*y,v*A+p*f*y,p*g,A*y-p*v*f,-g*y,f,g*v),this.normalize(),this},this.setFromQuaternion=function(t){return h=t.w*t.w,u=t.x*t.x,m=t.y*t.y,d=t.z*t.z,this.set(h+u-m-d,2*(t.x*t.y-t.w*t.z),2*(t.x*t.z+t.w*t.y),2*(t.x*t.y+t.w*t.z),h-u+m-d,2*(t.y*t.z-t.w*t.x),2*(t.x*t.z-t.w*t.y),2*(t.y*t.z+t.w*t.x),h-u-m+d),this},this.multiply=function(t){return c=E.RotationMatrix.prototype.multiplyMatrices(this,t),this.copy(c),this},this.rotateX=function(t){return c=E.RotationMatrix.prototype.rotateByAxisAngle(this,[1,0,0],t),this.copy(c),this},this.rotateY=function(t){return c=E.RotationMatrix.prototype.rotateByAxisAngle(this,[0,1,0],t),this.copy(c),this},this.rotateZ=function(t){return c=E.RotationMatrix.prototype.rotateByAxisAngle(this,[0,0,1],t),this.copy(c),this},this.normalize=function(){return E.RotationMatrix.prototype.normalize(this)},this.set(t,e,i,a,n,o,r,s,l)},E.RotationMatrix.prototype={constructor:E.RotationMatrix,multiplyMatrices:(nt=new E.RotationMatrix,function(t,e){return z=t.elements,G=e.elements,nt.set(z[0]*G[0]+z[1]*G[3]+z[2]*G[6],z[0]*G[1]+z[1]*G[4]+z[2]*G[7],z[0]*G[2]+z[1]*G[5]+z[2]*G[8],z[3]*G[0]+z[4]*G[3]+z[5]*G[6],z[3]*G[1]+z[4]*G[4]+z[5]*G[7],z[3]*G[2]+z[4]*G[5]+z[5]*G[8],z[6]*G[0]+z[7]*G[3]+z[8]*G[6],z[6]*G[1]+z[7]*G[4]+z[8]*G[7],z[6]*G[2]+z[7]*G[5]+z[8]*G[8]),nt}),normalize:function(t){var e=t.elements,i=e[0]*e[4]*e[8]-e[0]*e[5]*e[7]-e[1]*e[3]*e[8]+e[1]*e[5]*e[6]+e[2]*e[3]*e[7]-e[2]*e[4]*e[6];return e[0]/=i,e[1]/=i,e[2]/=i,e[3]/=i,e[4]/=i,e[5]/=i,e[6]/=i,e[7]/=i,e[8]/=i,t.elements=e,t},rotateByAxisAngle:(at=new E.RotationMatrix,L=new E.RotationMatrix,O=!1,function(t,e,i){return L.identity(),O=!1,M=Math.sin(i),I=Math.cos(i),1===e[0]&&0===e[1]&&0===e[2]?(O=!0,L.elements[4]=I,L.elements[5]=-M,L.elements[7]=M,L.elements[8]=I):1===e[1]&&0===e[0]&&0===e[2]?(O=!0,L.elements[0]=I,L.elements[2]=M,L.elements[6]=-M,L.elements[8]=I):1===e[2]&&0===e[0]&&0===e[1]&&(O=!0,L.elements[0]=I,L.elements[1]=-M,L.elements[3]=M,L.elements[4]=I),at=O?(at=E.RotationMatrix.prototype.multiplyMatrices(t,L),E.RotationMatrix.prototype.normalize(at)):t})},E.Euler=function(t,e,i){var c,h,u,a,n,o;this.set=function(t,e,i){this.alpha=t||0,this.beta=e||0,this.gamma=i||0},this.copy=function(t){this.alpha=t.alpha,this.beta=t.beta,this.gamma=t.gamma},this.setFromRotationMatrix=function(t){o=0<(o=t.elements)[8]?(a=Math.atan2(-o[1],o[4]),n=Math.asin(o[7]),Math.atan2(-o[6],o[8])):o[8]<0?(a=Math.atan2(o[1],-o[4]),n=-Math.asin(o[7]),n+=0<=n?-m:m,Math.atan2(o[6],-o[8])):0<o[6]?(a=Math.atan2(-o[1],o[4]),n=Math.asin(o[7]),-d):o[6]<0?(a=Math.atan2(o[1],-o[4]),n=-Math.asin(o[7]),n+=0<=n?-m:m,-d):(a=Math.atan2(o[3],o[0]),n=0<o[7]?d:-d,0),a<0&&(a+=H),a*=g,n*=g,o*=g,this.set(a,n,o)},this.setFromQuaternion=function(t){var e,i,a=t.w*t.w,n=t.x*t.x,o=t.y*t.y,r=t.z*t.z,s=a+n+o+r,l=t.w*t.x+t.y*t.z;u=.499999*s<l?(c=2*Math.atan2(t.y,t.w),h=d,0):l<(1e-6-.5)*s?(c=-2*Math.atan2(t.y,t.w),h=-d,0):(e=a-n+o-r,i=2*(t.w*t.z-t.x*t.y),t=2*(t.w*t.y-t.x*t.z),0<(a=a-n-o+r)?(c=Math.atan2(i,e),h=Math.asin(2*l/s),Math.atan2(t,a)):(c=Math.atan2(-i,-e),h=-Math.asin(2*l/s),h+=h<0?m:-m,Math.atan2(-t,-a))),c<0&&(c+=H),c*=g,h*=g,u*=g,this.set(c,h,u)},this.rotateX=function(t){return E.Euler.prototype.rotateByAxisAngle(this,[1,0,0],t),this},this.rotateY=function(t){return E.Euler.prototype.rotateByAxisAngle(this,[0,1,0],t),this},this.rotateZ=function(t){return E.Euler.prototype.rotateByAxisAngle(this,[0,0,1],t),this},this.set(t,e,i)},E.Euler.prototype={constructor:E.Euler,rotateByAxisAngle:(_=new E.RotationMatrix,function(t,e,i){return _.setFromEuler(t),_=E.RotationMatrix.prototype.rotateByAxisAngle(_,e,i),t.setFromRotationMatrix(_),t})},E.DeviceOrientation=function(t){this.options=t||{};var e,i,a=0,n=0;this.alphaOffsetScreen=0,this.alphaOffsetDevice=void 0,"game"===this.options.type?(e=function(t){return null!==t.alpha&&(this.alphaOffsetDevice=new E.Euler(t.alpha,0,0),this.alphaOffsetDevice.rotateZ(-f),10<=++n)?void o.removeEventListener("deviceorientation",e,!1):void(200<=++a&&o.removeEventListener("deviceorientation",e,!1))}.bind(this),o.addEventListener("deviceorientation",e,!1)):"world"===this.options.type&&(i=function(t){return!0!==t.absolute&&void 0!==t.webkitCompassAccuracy&&null!==t.webkitCompassAccuracy&&0<=+t.webkitCompassAccuracy&&+t.webkitCompassAccuracy<50&&(this.alphaOffsetDevice=new E.Euler(t.webkitCompassHeading,0,0),this.alphaOffsetDevice.rotateZ(f),this.alphaOffsetScreen=f,10<=++n)?void o.removeEventListener("deviceorientation",i,!1):void(200<=++a&&o.removeEventListener("deviceorientation",i,!1))}.bind(this),o.addEventListener("deviceorientation",i,!1))},E.DeviceOrientation.prototype={constructor:E.DeviceOrientation,start:function(t){t&&"[object Function]"==Object.prototype.toString.call(t)&&v.orientation.callbacks.push(t),p?o.screen.orientation.addEventListener("change",ut,!1):o.addEventListener("orientationchange",ut,!1),v.orientation.active||(o.addEventListener("deviceorientation",mt,!1),v.orientation.active=!0)},stop:function(){v.orientation.active&&(o.removeEventListener("deviceorientation",mt,!1),v.orientation.active=!1)},listen:function(t){this.start(t)},getFixedFrameQuaternion:(w=new E.Euler,et=new E.RotationMatrix,it=new E.Quaternion,function(){var t=v.orientation.data||{alpha:0,beta:0,gamma:0},e=t.alpha;return this.alphaOffsetDevice&&(et.setFromEuler(this.alphaOffsetDevice),et.rotateZ(-this.alphaOffsetScreen),w.setFromRotationMatrix(et),w.alpha<0&&(w.alpha+=360),w.alpha%=360,e-=w.alpha),w.set(e,t.beta,t.gamma),it.setFromEuler(w),it}),getScreenAdjustedQuaternion:function(){return(tt=this.getFixedFrameQuaternion()).rotateZ(-f),tt},getFixedFrameMatrix:(T=new E.Euler,R=new E.RotationMatrix,function(){var t=v.orientation.data||{alpha:0,beta:0,gamma:0},e=t.alpha;return this.alphaOffsetDevice&&(R.setFromEuler(this.alphaOffsetDevice),R.rotateZ(-this.alphaOffsetScreen),T.setFromRotationMatrix(R),T.alpha<0&&(T.alpha+=360),T.alpha%=360,e-=T.alpha),T.set(e,t.beta,t.gamma),R.setFromEuler(T),R}),getScreenAdjustedMatrix:function(){return($=this.getFixedFrameMatrix()).rotateZ(-f),$},getFixedFrameEuler:(K=new E.Euler,function(){return J=this.getFixedFrameMatrix(),K.setFromRotationMatrix(J),K}),getScreenAdjustedEuler:(q=new E.Euler,function(){return V=this.getScreenAdjustedMatrix(),q.setFromRotationMatrix(V),q}),isAbsolute:function(){return!(!v.orientation.data||!0!==v.orientation.data.absolute)},getLastRawEventData:function(){return v.orientation.data||{}},_alphaAvailable:!1,_betaAvailable:!1,_gammaAvailable:!1,isAvailable:function(t){switch(t){case this.ALPHA:return this._alphaAvailable;case this.BETA:return this._betaAvailable;case this.GAMMA:return this._gammaAvailable}},ALPHA:"alpha",BETA:"beta",GAMMA:"gamma"},E.DeviceMotion=function(t){this.options=t||{}},E.DeviceMotion.prototype={constructor:E.DeviceMotion,start:function(t){t&&"[object Function]"==Object.prototype.toString.call(t)&&v.motion.callbacks.push(t),p?o.screen.orientation.addEventListener("change",ut,!1):o.addEventListener("orientationchange",ut,!1),v.motion.active||(o.addEventListener("devicemotion",dt,!1),v.motion.active=!0)},stop:function(){v.motion.active&&(o.removeEventListener("devicemotion",dt,!1),v.motion.active=!1)},listen:function(t){this.start(t)},getScreenAdjustedAcceleration:function(){var t=v.motion.data&&v.motion.data.acceleration?v.motion.data.acceleration:{x:0,y:0,z:0},e={};switch(f){case y:e.x=-t.y,e.y=t.x;break;case A:e.x=-t.x,e.y=-t.y;break;case b:case W:e.x=t.y,e.y=-t.x;break;default:e.x=t.x,e.y=t.y}return e.z=t.z,e},getScreenAdjustedAccelerationIncludingGravity:function(){var t=v.motion.data&&v.motion.data.accelerationIncludingGravity?v.motion.data.accelerationIncludingGravity:{x:0,y:0,z:0},e={};switch(f){case y:e.x=-t.y,e.y=t.x;break;case A:e.x=-t.x,e.y=-t.y;break;case b:case W:e.x=t.y,e.y=-t.x;break;default:e.x=t.x,e.y=t.y}return e.z=t.z,e},getScreenAdjustedRotationRate:function(){var t=v.motion.data&&v.motion.data.rotationRate?v.motion.data.rotationRate:{alpha:0,beta:0,gamma:0},e={};switch(f){case y:e.beta=-t.gamma,e.gamma=t.beta;break;case A:e.beta=-t.beta,e.gamma=-t.gamma;break;case b:case W:e.beta=t.gamma,e.gamma=-t.beta;break;default:e.beta=t.beta,e.gamma=t.gamma}return e.alpha=t.alpha,e},getLastRawEventData:function(){return v.motion.data||{}},_accelerationXAvailable:!1,_accelerationYAvailable:!1,_accelerationZAvailable:!1,_accelerationIncludingGravityXAvailable:!1,_accelerationIncludingGravityYAvailable:!1,_accelerationIncludingGravityZAvailable:!1,_rotationRateAlphaAvailable:!1,_rotationRateBetaAvailable:!1,_rotationRateGammaAvailable:!1,isAvailable:function(t){switch(t){case this.ACCELERATION_X:return this._accelerationXAvailable;case this.ACCELERATION_Y:return this._accelerationYAvailable;case this.ACCELERATION_Z:return this._accelerationZAvailable;case this.ACCELERATION_INCLUDING_GRAVITY_X:return this._accelerationIncludingGravityXAvailable;case this.ACCELERATION_INCLUDING_GRAVITY_Y:return this._accelerationIncludingGravityYAvailable;case this.ACCELERATION_INCLUDING_GRAVITY_Z:return this._accelerationIncludingGravityZAvailable;case this.ROTATION_RATE_ALPHA:return this._rotationRateAlphaAvailable;case this.ROTATION_RATE_BETA:return this._rotationRateBetaAvailable;case this.ROTATION_RATE_GAMMA:return this._rotationRateGammaAvailable}},ACCELERATION_X:"accelerationX",ACCELERATION_Y:"accelerationY",ACCELERATION_Z:"accelerationZ",ACCELERATION_INCLUDING_GRAVITY_X:"accelerationIncludingGravityX",ACCELERATION_INCLUDING_GRAVITY_Y:"accelerationIncludingGravityY",ACCELERATION_INCLUDING_GRAVITY_Z:"accelerationIncludingGravityZ",ROTATION_RATE_ALPHA:"rotationRateAlpha",ROTATION_RATE_BETA:"rotationRateBeta",ROTATION_RATE_GAMMA:"rotationRateGamma"},o.FULLTILT=E),X={GyroNorm:(k="deviceorientation",P="acceleration",j="accelerationinludinggravity",r=Q=0,i=e=!(B="rotationrate"),Z=50,c=!(l=s=t=null),h=Y="game",n=null,u=!(a=2),C.GAME=Y,C.WORLD="world",C.DEVICE_ORIENTATION=k,C.ACCELERATION=P,C.ACCELERATION_INCLUDING_GRAVITY=j,C.ROTATION_RATE=B,C.prototype.init=function(t){t&&t.frequency&&(Z=t.frequency),t&&t.gravityNormalized&&(c=t.gravityNormalized),t&&t.orientationBase&&(h=t.orientationBase),t&&"number"==typeof t.decimalCount&&0<=t.decimalCount&&(a=parseInt(t.decimalCount)),t&&t.logger&&(n=t.logger),t&&t.screenAdjusted&&(u=t.screenAdjusted);var t=new FULLTILT.getDeviceOrientation({type:h}).then(function(t){s=t}),e=(new FULLTILT.getDeviceMotion).then(function(t){r=0<(l=t).getScreenAdjustedAccelerationIncludingGravity().z?-1:1});return Promise.all([t,e]).then(function(){i=!0})},C.prototype.end=function(){try{i=!1,this.stop(),l.stop(),s.stop()}catch(t){lt(t)}},C.prototype.start=function(o){return i?(t=setInterval(function(){var t,e,i,a,n;o((t=u?s.getScreenAdjustedEuler():s.getFixedFrameEuler(),e=l.getScreenAdjustedAcceleration(),i=l.getScreenAdjustedAccelerationIncludingGravity(),a=l.getScreenAdjustedRotationRate(),n=0,n={do:{alpha:F(n=h===Y?(n=t.alpha-Q)<0?360-Math.abs(n):n:t.alpha),beta:F(t.beta),gamma:F(t.gamma),absolute:s.isAbsolute()},dm:{x:F(e.x),y:F(e.y),z:F(e.z),gx:F(i.x),gy:F(i.y),gz:F(i.z),alpha:F(a.alpha),beta:F(a.beta),gamma:F(a.gamma)}},c&&(n.dm.gx*=r,n.dm.gy*=r,n.dm.gz*=r),n))},Z),void(e=!0)):void lt({message:'GyroNorm is not initialized yet. First call the "init()" function.',code:1})},C.prototype.stop=function(){t&&(clearInterval(t),e=!1)},C.prototype.normalizeGravity=function(t){c=!!t},C.prototype.setHeadDirection=function(){return!u&&"world"!==h&&(Q=s.getFixedFrameEuler().alpha,!0)},C.prototype.startLogging=function(t){t&&(n=t)},C.prototype.stopLogging=function(){n=null},C.prototype.isAvailable=function(t){var e=s.getScreenAdjustedEuler(),i=l.getScreenAdjustedAcceleration(),a=l.getScreenAdjustedAccelerationIncludingGravity(),n=l.getScreenAdjustedRotationRate();switch(t){case k:return e.alpha&&null!==e.alpha&&e.beta&&null!==e.beta&&e.gamma&&null!==e.gamma;case P:return i&&i.x&&i.y&&i.z;case j:return a&&a.x&&a.y&&a.z;case B:return n&&n.alpha&&n.beta&&n.gamma;default:return{deviceOrientationAvailable:e.alpha&&null!==e.alpha&&e.beta&&null!==e.beta&&e.gamma&&null!==e.gamma,accelerationAvailable:i&&i.x&&i.y&&i.z,accelerationIncludingGravityAvailable:a&&a.x&&a.y&&a.z,rotationRateAvailable:n&&n.alpha&&n.beta&&n.gamma}}},C.prototype.isRunning=function(){return e},C)},void 0!==(U=function(){return X}.call(S,U,S,N))&&(N.exports=U)}]);