<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="GicLYNNqJJ-XBSPlE8Pz-ZwGf2ElS_d_VRcEsQServ4"><meta name="google-site-verification" content="rn4dOdASKHwgOgBKFwN8nAB0OlnuC_pNB8qLDnMyPpc"><meta name="baidu-site-verification" content="093lY4ziMu"><meta name="baidu-site-verification" content="code-W4A0ktcwoi"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="description" content="nojsja ä¸ªäººåšå®¢"><meta name="keyword" content=""><link rel="shortcut icon" href="img/favicon.ico"><link href="fonts/fontawesome-webfont.woff2?v=4.3.0" rel="preload" as="font" crossorigin><link href="https://www.google-analytics.com" rel="preconnect" crossorigin><link href="http://busuanzi.ibruce.info" rel="preconnect" crossorigin><link href="http://nojsja.gitee.io" rel="preconnect" crossorigin><title>Shadowsocks è·¨å¹³å°å®¢æˆ·ç«¯å¼€å‘æ—¥è®° - nojsja | Blog</title><link rel="canonical" href="https://nojsja.github.io/blogs/2021/10/04/5384287.html/"><link href="https://cdn.usebootstrap.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/dusign-light.css"><link rel="stylesheet" href="/css/github-markdown.min.css"><style>.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:45px}@media (max-width:767px){.markdown-body{padding:15px}}</style><link rel="stylesheet" href="/css/widget.css"><link rel="stylesheet" href="/css/fonts.googleapis.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><script>function async(e,t,a,n){var c=document.head||document.getElementsByTagName("head")[0]||document.documentElement,d=document,r=a||"script",s=d.createElement(r),l=d.getElementsByTagName(r)[0];switch(n=["async","defer"].includes(n)?n:!!n,r){case"script":s.src=e,n&&(s[n]=!0);break;case"link":s.type="text/css",s.href=e,s.rel="stylesheet";break;default:s.src=e}t&&(s.readyState?s.onreadystatechange=function(e){"loaded"!=s.readyState&&"complete"!=s.readyState||(s.onreadystatechange=null,t(null,e)())}:s.onload=function(e){t(null,e)}),l.parentNode.insertBefore(s,c.firstChild)}</script><script>function sendXMLHttpRequest(e){var t=e.url,n=(e.method||"get").toUpperCase(),s=e.callback,a=!("async"in e)||!!e.async,c=null;t&&((c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).open(n,t,a),c.onreadystatechange=function(){4===this.readyState&&(s&&s(this.responseText),c.onreadystatechange=null)},c.send(null))}</script><script>var fnDebounce=function(n,l){var t=null;return function(){return t?Date.now()-t>=l?(t=null,n.apply(this,[].slice.call(arguments))):void(t=Date.now()):t=Date.now()}},fnThrottle=function(n,l){var t=null;return function(){return t?Date.now()-t>=l?(t=null,n.apply(this,[].slice.call(arguments))):void 0:t=Date.now()}}</script><script>"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype?"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}}):sendXMLHttpRequest({url:"js/intersection-observer.js",async:!1,method:"get",callback:function(txt){eval(txt)}})</script><script src="/js/buttons.js" async defer></script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="nojsja" type="application/atom+xml">
</head><body><style type="text/css">header.intro-header{background-image:linear-gradient(rgba(0,0,0,.3),rgba(0,0,0,.3)),url(https://nojsja.gitee.io/static-resources/images/hexo/article_header/article_header.jpg)}</style><header class="intro-header"><div id="signature"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="post-heading"><div class="tags"><a class="tag" href="/tags/#shadowsocks" title="shadowsocks">shadowsocks</a> <a class="tag" href="/tags/#electron" title="electron">electron</a> <a class="tag" href="/tags/#ssr" title="ssr">ssr</a></div><h1>Shadowsocks è·¨å¹³å°å®¢æˆ·ç«¯å¼€å‘æ—¥è®°</h1><h2 class="subheading">Shadowsocks crossplatform desktop app dev diary</h2><span class="meta"><span class="post-description"><i class="fa fa-user" aria-hidden="true"></i> nojsja </span><span class="post-description"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-10-04</span></span><div class="blank_box"></div><span class="meta">å­—æ•°ï¼š<span class="post-count">9.9k</span>ä¸¨ é˜…è¯»æ—¶é—´ï¼š<span class="post-count">45</span> åˆ†é’Ÿ</span><div class="blank_box"></div></div></div></div></div></div><div class="waveWrapper"><div class="wave wave_before" style="background-image:url(img/wave-light.png)"></div><div class="wave wave_after" style="background-image:url(img/wave-light.png)"></div></div></header><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class="container-fluid"><div class="navbar-header page-scroll"><button type="button" class="navbar-toggle"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">nojsja</a></div><div id="huxblog_navbar"><div class="navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/">é¦–é¡µ</a></li><li><a href="/about/">å…³äº</a></li><li><a href="/archive/">æ—¶é—´è½´</a></li><li><a href="/categories/">ç›®å½•</a></li><li><a href="/tags/">æ ‡ç­¾</a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");function handleMagic(e){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout((function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")}),400)):($collapse.style.height="auto",$navbar.className+=" in")}$toggle.addEventListener("click",handleMagic)</script><style>.table-responsive{border:none!important}</style><article><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container markdown-body"><p><a target="_blank" rel="noopener" href="https://nojsja.gitee.io/blogs/2021/10/04/5384287.html/">&gt;&gt;&gt; åšå®¢åŸæ–‡</a></p><h2 id="Preface">Preface</h2><blockquote><p>å‰è¨€</p></blockquote><p>æœ€è¿‘é—²é€› github æ—¶çœ‹åˆ°ä¸€ä¸ª <code>shadowsocks-electron</code> é¡¹ç›®ï¼Œè¯¥å·¥å…·æ”¯æŒ Linux / Mac å¹³å°ï¼Œæ˜¯ç”¨æ¥è¿æ¥ shadowsocks æœåŠ¡å™¨çš„ proxyâœˆï¸ï¼Œç¨‹åºå‘˜åº”è¯¥å¤§å¤šéƒ½ç”¨è¿‡ï¼Œå„ä¸ªå¹³å°ä¹Ÿéƒ½æœ‰é€‚é…å®¢æˆ·ç«¯ã€‚åŸä½œè€…ä½¿ç”¨ <code>Typescript/Electron</code> æŠŠåŠŸèƒ½å¼€å‘äº†ä¸€éƒ¨åˆ†å°±æ²¡æœ‰ç»´æŠ¤äº†ï¼Œåªæ”¯æŒäº†åŸºæœ¬çš„ï¼šæ·»åŠ ã€ä¿®æ”¹ã€è¿æ¥ã€åˆ é™¤ proxy å’Œè®¾ç½®åŠŸèƒ½ï¼Œå¼€æœºè‡ªå¯ä¹Ÿåªé€‚é…äº† Macã€‚</p><p>ç”±äºæœ€è¿‘åœ¨å­¦ä¹  <code>Typescript</code> è¯­è¨€è‹¦äºæ²¡æœ‰å®è·µæœºä¼šï¼ŒåŠ ä¹‹æˆ‘è‡ªå·±çš„ Ubuntu20.04 æ“ä½œç³»ç»Ÿè¿è¡Œ <code>electron-ssr</code> è€æœ‰é—®é¢˜(å¯ä»¥ä½¿ç”¨å¾ˆä¹…æ²¡æœ‰ç»´æŠ¤å·²ç»ä¸‹æ¶å®˜æ–¹è½¯ä»¶æºçš„<code>Shadowsocks-QT</code>è¿›è¡Œæ›¿ä»£ğŸ¤£)ï¼Œæ‰€ä»¥èŒç”Ÿäº†è‡ªå·±æ¥ç›˜è¿›è¡Œå¼€å‘çš„æƒ³æ³•ï¼Œç„¶åå°±æ˜¯ fork -&gt; clone -&gt; dev(day after day) -&gt; compile -&gt; push ä¸€é¡¿æ“ä½œã€‚</p><blockquote><p>githubä»“åº“ï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/nojsja/shadowsocks-electron">shadowsocks-electron</a></p></blockquote><h2 id="Prevew">Prevew</h2><blockquote><p>é¢„è§ˆ</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/main.png" alt="main"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/settings.png" alt="settings"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/add_server.png" alt="add_server"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/server_config.png" alt="server_config"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/share.png" alt="share"></p><h2 id="Contents">Contents</h2><blockquote><p>ç›®å½•</p></blockquote><ul><li><a href="#preface">Preface</a></li><li><a href="#prevew">Prevew</a></li><li><a href="#contents">Contents</a></li><li><a href="#tools--technology">Tools &amp; Technology</a><ul><li><a href="#1-%E4%BD%8E%E9%85%8D%E7%BD%AE%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83react-app-rewired">1. ä½é…ç½®å¿«é€Ÿå¯åŠ¨å‰ç«¯å¼€å‘ç¯å¢ƒï¼šreact-app-rewired</a></li><li><a href="#2-%E4%BB%A3%E7%A0%81%E6%9B%B4%E6%94%B9%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AFnodemon">2. ä»£ç æ›´æ”¹è‡ªåŠ¨é‡å¯ï¼šnodemon</a></li><li><a href="#3-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96redux-persistredux-persist-electron-storage">3. æ•°æ®æŒä¹…åŒ–ï¼šredux-persist/redux-persist-electron-storage</a></li><li><a href="#4-%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85electron-builder">4. é¡¹ç›®æ‰“åŒ…ï¼šelectron-builder</a></li><li><a href="#5-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%90%E8%A1%8C%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86winston">5. å®¢æˆ·ç«¯è¿è¡Œæ—¥å¿—ç®¡ç†ï¼šwinston</a></li></ul></li><li><a href="#core-functions">Core Functions</a><ul><li><a href="#1-%E8%A7%A3%E6%9E%90-shadowsocks-%E4%B8%93%E7%94%A8%E5%8A%A0%E5%AF%86%E9%93%BE%E6%8E%A5">1. è§£æ Shadowsocks ä¸“ç”¨åŠ å¯†é“¾æ¥</a></li><li><a href="#2-%E5%B0%86%E5%B7%B2%E6%9C%89%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%9B%BE%E7%89%87%E8%BF%9B%E8%A1%8C%E5%88%86%E4%BA%AB">2. å°†å·²æœ‰çš„æœåŠ¡å™¨é…ç½®ç”ŸæˆäºŒç»´ç å›¾ç‰‡è¿›è¡Œåˆ†äº«</a></li><li><a href="#3-%E8%AF%BB%E5%8F%96%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%AF%BC%E5%85%A5-shadowsocks-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE">3. è¯»å–äºŒç»´ç å¯¼å…¥ Shadowsocks æœåŠ¡å™¨é…ç½®</a></li><li><a href="#4-%E5%A4%9A%E5%B9%B3%E5%8F%B0%E5%8A%9F%E8%83%BD%E9%80%82%E9%85%8D%E4%B9%8B-shadowsocks-libev-%E5%BA%93%E7%9A%84%E4%BE%9D%E8%B5%96%E5%A4%84%E7%90%86">4. å¤šå¹³å°åŠŸèƒ½é€‚é…ä¹‹ <code>shadowsocks-libev</code> åº“çš„ä¾èµ–å¤„ç†</a></li><li><a href="#5-electron-%E8%B0%83%E7%94%A8-shadowsocks-libev-%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8">5. Electron è°ƒç”¨ <code>shadowsocks-libev</code> åº“è¿æ¥æœåŠ¡å™¨</a></li><li><a href="#6-%E5%A4%9A%E5%B9%B3%E5%8F%B0%E5%8A%9F%E8%83%BD%E9%80%82%E9%85%8D%E4%B9%8B%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9F-proxy-%E5%92%8C-pac-%E6%9C%8D%E5%8A%A1">6. å¤šå¹³å°åŠŸèƒ½é€‚é…ä¹‹è®¾ç½®ç³»ç»Ÿ proxy å’Œ pac æœåŠ¡</a><ul><li><a href="#%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9F-proxy">è®¾ç½®ç³»ç»Ÿ proxy</a></li><li><a href="#%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9F-pac-%E6%96%87%E4%BB%B6%E5%9C%B0%E5%9D%80">è®¾ç½®ç³»ç»Ÿ pac æ–‡ä»¶åœ°å€</a></li></ul></li><li><a href="#7-%E5%A4%9A%E5%B9%B3%E5%8F%B0%E5%8A%9F%E8%83%BD%E9%80%82%E9%85%8D%E4%B9%8B%E5%BA%94%E7%94%A8%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8">7. å¤šå¹³å°åŠŸèƒ½é€‚é…ä¹‹åº”ç”¨å¼€æœºè‡ªå¯åŠ¨</a></li><li><a href="#8-%E4%BD%BF%E7%94%A8-electron-%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E5%99%A8%E6%8F%90%E9%AB%98%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95%E6%95%88%E7%8E%87">8. ä½¿ç”¨ Electron è¿›ç¨‹ç®¡ç†å™¨æé«˜å¼€å‘è°ƒè¯•æ•ˆç‡</a></li></ul></li><li><a href="#others">Others</a><ul><li><a href="#1-mac-%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9C%9F%E6%98%AF%E9%9A%BE%E8%A3%85">1. Mac è™šæ‹ŸæœºçœŸæ˜¯éš¾è£…</a></li><li><a href="#2-mac-brew-%E5%9C%A8%E5%9B%BD%E5%86%85%E7%8E%AF%E5%A2%83%E7%9A%84%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F">2. Mac brew åœ¨å›½å†…ç¯å¢ƒçš„å®‰è£…æ–¹å¼</a></li><li><a href="#3-nodejs-childprocess-%E6%89%A7%E8%A1%8C%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91">3. Node.js child_process æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸€äº›å‘</a></li><li><a href="#4-%E6%80%8E%E6%A0%B7%E4%B8%BA%E6%9C%AA%E9%80%82%E9%85%8D-typescript-%E7%9A%84%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85%E7%BC%96%E5%86%99-types-%E5%A3%B0%E6%98%8E">4. æ€æ ·ä¸ºæœªé€‚é… Typescript çš„ç¬¬ä¸‰æ–¹åŒ…ç¼–å†™ @types å£°æ˜</a></li><li><a href="#5-%E6%84%9F%E8%B0%A2%E4%BD%9C%E4%B8%BA-ui-%E8%AE%BE%E8%AE%A1%E5%B8%88%E7%9A%84-gf-%E5%80%BE%E6%83%85%E6%94%AF%E6%8C%81">5. æ„Ÿè°¢ä½œä¸º UI è®¾è®¡å¸ˆçš„ GF å€¾æƒ…æ”¯æŒ</a></li><li><a href="#6-%E5%BB%B6%E4%BC%B8%E9%98%85%E8%AF%BB">6. å»¶ä¼¸é˜…è¯»</a></li></ul></li><li><a href="#final">Final</a></li></ul><h2 id="Tools-Technology">Tools &amp; Technology</h2><blockquote><p>å·¥å…·å’ŒæŠ€æœ¯</p></blockquote><p>é¡¹ç›®åŸºäº <code>Typescript@3.8.3</code> / <code>React@16.13.1</code> / <code>MaterialUI@4.9.8</code> / <code>Electron@13.4.0</code></p><h3 id="1-ä½é…ç½®å¿«é€Ÿå¯åŠ¨å‰ç«¯å¼€å‘ç¯å¢ƒï¼šreact-app-rewired">1. ä½é…ç½®å¿«é€Ÿå¯åŠ¨å‰ç«¯å¼€å‘ç¯å¢ƒï¼šreact-app-rewired</h3><p>æ­¤å·¥å…·å¯ä»¥åœ¨ä¸ â€˜ejectâ€™ ä¹Ÿä¸åˆ›å»ºé¢å¤– react-scripts çš„æƒ…å†µä¸‹ä¿®æ”¹ create-react-app å†…ç½®çš„ webpack é…ç½®ï¼Œç„¶åä½ å°†æ‹¥æœ‰ create-react-app çš„ä¸€åˆ‡ç‰¹æ€§ï¼Œä¸”å¯ä»¥æ ¹æ®ä½ çš„éœ€è¦å»é…ç½® webpack çš„ plugins, loaders ç­‰ã€‚</p><p>é€šè¿‡ npm å®‰è£…ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install react-app-rewired --save-dev</span><br></pre></td></tr></table></figure><p>æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª config-overrides.js å‚è€ƒå®˜æ–¹è¯´æ˜è¿›è¡Œé…ç½®ï¼Œæ³¨æ„ npm ä¸Šä¹Ÿæœ‰å¾ˆå¤šåŸºäº <code>react-app-rewired</code> çš„ä¸“ç”¨æ’ä»¶ç”¨äºåˆ†ç¦»è§£å†³å„ä¸ªåŸå­åŒ–åŠŸèƒ½ï¼Œå¯ä»¥è‡ªè¡Œæ¢ç´¢å“¦ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="keyword">override</span>,</span><br><span class="line">  useBabelRc,</span><br><span class="line">  removeModuleScopePlugin,</span><br><span class="line">  babelInclude,</span><br><span class="line">  setWebpackTarget</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&quot;customize-cra&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> rewireSvgReactLoader = <span class="built_in">require</span>(<span class="string">&#x27;react-app-rewire-svg-react-loader&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">webpack</span>: <span class="title function_">override</span>(</span><br><span class="line">    <span class="comment">// bab el</span></span><br><span class="line">    <span class="title function_">useBabelRc</span>(),</span><br><span class="line">    <span class="comment">// svg loader</span></span><br><span class="line">    <span class="function">(<span class="params">config, env</span>) =&gt;</span> &#123;</span><br><span class="line">      config = <span class="title function_">rewireSvgReactLoader</span>(config, env);</span><br><span class="line">      <span class="keyword">return</span> config;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">removeModuleScopePlugin</span>(),</span><br><span class="line">    <span class="title function_">babelInclude</span>([path.<span class="title function_">resolve</span>(<span class="string">&quot;renderer&quot;</span>)]),</span><br><span class="line">    <span class="comment">// render target</span></span><br><span class="line">    <span class="title function_">setWebpackTarget</span>(<span class="string">&quot;electron-renderer&quot;</span>)</span><br><span class="line">  ),</span><br><span class="line">  <span class="attr">paths</span>: <span class="keyword">function</span>(<span class="params">paths, env</span>) &#123;</span><br><span class="line">    paths.<span class="property">appIndexJs</span> = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;renderer/index.tsx&quot;</span>);</span><br><span class="line">    paths.<span class="property">appSrc</span> = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;renderer&quot;</span>);</span><br><span class="line">    paths.<span class="property">appTypeDeclarations</span> = path.<span class="title function_">resolve</span>(</span><br><span class="line">      __dirname,</span><br><span class="line">      <span class="string">&quot;renderer/react-app-env.d.ts&quot;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> paths;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-ä»£ç æ›´æ”¹è‡ªåŠ¨é‡å¯ï¼šnodemon">2. ä»£ç æ›´æ”¹è‡ªåŠ¨é‡å¯ï¼šnodemon</h3><p>åœ¨å¼€å‘ Node.js é¡¹ç›®æ—¶æˆ‘ç»å¸¸ç”¨å®ƒæ¥ç›‘å¬æ–‡ä»¶æ›´æ”¹ç„¶åè‡ªåŠ¨é‡å¯åº”ç”¨ï¼ŒElectron åº”ç”¨ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚åœ¨ <code>package.json</code> ä¸­é…ç½®ç›¸å…³çš„å­—æ®µç„¶åè®© <code>nodemon</code> ç›‘å¬ä¸»è¿›ç¨‹ä»£ç å¹¶è¿›è¡Œ Typescript å®æ—¶ç¼–è¯‘å’Œ Electron ä¸»è¿›ç¨‹é‡å¯ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shadowsocks-electron&quot;</span><span class="punctuation">,</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start:main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nodemon&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;nodemonConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;watch&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;main&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ignore&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;main/types/**/*&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ext&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ts,json&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;exec&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yarn build:main &amp;&amp; electron .&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  ...</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="3-æ•°æ®æŒä¹…åŒ–ï¼šredux-persist-redux-persist-electron-storage">3. æ•°æ®æŒä¹…åŒ–ï¼šredux-persist/redux-persist-electron-storage</h3><p>Electron åº”ç”¨å¸¸å¸¸æ¶‰åŠä¸€äº›æŒä¹…åŒ–æ•°æ®çš„åŠŸèƒ½ï¼Œæ¯”å¦‚åœ¨ <code>shadowsocks-electron</code> ä¸­çš„æœåŠ¡å™¨é…ç½®è¯»å†™ã€æ—¥å¿—ä¿å­˜å’Œç”¨æˆ·è®¾ç½®ä¿å­˜ç­‰ã€‚ä¹‹å‰åœ¨å¼€å‘ä¸€ä¸ªç±»ä¼¼ç™¾åº¦ç½‘ç›˜çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ—¶ï¼Œéœ€è¦ä¿å­˜æ–‡ä»¶ä¸Šä¼ è®°å½•ï¼Œå½“æ—¶é€‰ç”¨äº† <code>lowdb</code> è¿›è¡Œæ”¯æŒï¼Œå®ƒæ˜¯ä¸€ç§ JSON æ–‡ä»¶æ•°æ®åº“ï¼Œæä¾›ç±»ä¼¼æ•°æ®åº“çš„åŠŸèƒ½ä½†æ˜¯ä½¿ç”¨ JSON å­—ç¬¦ä¸²è¿›è¡Œæ˜æ–‡å­˜å‚¨ã€‚è¿™ç§å­˜å‚¨æ–¹å¼æ€§èƒ½è‡ªç„¶å¾ˆä¸€èˆ¬ï¼Œä¸è¿‡å·²ç»èƒ½æ»¡è¶³è‡³å¤šä¿å­˜ 5000 æ¡ä¸Šä¼ è®°å½•çš„éœ€æ±‚äº†ã€‚</p><p>ç”±äºç±»ä¼¼ <code>lowdb</code> è¿™ç§å·¥å…·åªèƒ½åœ¨ Electron ä¸»è¿›ç¨‹ç«¯è¿›è¡Œæ“ä½œï¼Œå› ä¸º UI æ¸²æŸ“è¿›ç¨‹å’Œä¸»è¿›ç¨‹çš„æ•°æ®åŒæ­¥æ“ä½œå°±ä¼šæ˜¾å¾—æ ¼å¤–å†—ä½™ã€‚</p><p>ä¸ºäº†ç®€åŒ–æ•°æ®äº¤äº’å¹¶èƒ½è¾¾åˆ°æŒä¹…åŒ–å­˜å‚¨çš„ç›®çš„ï¼Œå¯ä»¥é€‰ç”¨ <code>redux-persist</code> ä¸ºè§£å†³æ–¹æ¡ˆã€‚å¼•å…¥ä¹‹åå®ƒå¯ä»¥å’Œ Redux çŠ¶æ€ç®¡ç†åº“æ— ç¼é…åˆï¼Œæ— éœ€æ‰‹åŠ¨è§¦å‘å¤šä½™çš„æ•°æ®å­˜å–æ“ä½œã€‚æˆ‘ä»¬åªéœ€è¦åœ¨å‰ç«¯ä»£ç ä¸­å…³æ³¨ Reducer å’Œ Action çš„ç¼–å†™å³å¯ï¼Œæ‰€æœ‰çš„æŒä¹…åŒ–æ“ä½œéƒ½æ˜¯é€æ˜ä¸å¯è§çš„ã€‚</p><p><code>redux-persist</code> åº•å±‚ä¾èµ–äº† Electron æ¸²æŸ“è¿›ç¨‹åŸç”Ÿçš„ <code>remote</code> è¿œç¨‹è°ƒç”¨è¿›è¡Œå®ç°ï¼Œå‰ç«¯ store ä¸­çš„æ•°æ®æœ€ç»ˆä¼šè¢«å­˜æ”¾åˆ° Electron è¿›ç¨‹è¿è¡Œè·¯å¾„ä¸‹çš„æŸä¸ªæ–‡ä»¶é‡Œï¼Œåº”ç”¨å¼€å¯çš„æ—¶å€™è¿™äº›æ•°æ®åˆä¼šä»æ–‡ä»¶ä¸­è¯»å–åˆ° storeä¸­ã€‚</p><p>ä¸è¿‡æ­£æ˜¯ç”±äº <code>redux-persist</code> é‡‡ç”¨äº† <code>remote</code> è¿œç¨‹è°ƒç”¨è¿™ç§é€šä¿¡æ–¹å¼ï¼Œå¯¼è‡´æˆ‘çš„åº”ç”¨ä¸èƒ½ä½¿ç”¨æœ€æ–°å‘å¸ƒçš„ Electron ç‰ˆæœ¬ï¼Œè½¬è€Œä½¿ç”¨æ”¯æŒ <code>remote</code> API çš„ 13.4.0 ç‰ˆæœ¬ã€‚æˆ‘çœ‹äº†ä¸€ä¸‹å®ƒçš„ github ä»“åº“ï¼ŒREADME ä¸­è¯´ç°åœ¨æ˜¯æ— äººç»´æŠ¤çš„çŠ¶æ€ï¼Œå¸Œæœ›æœ‰å¼€æºçˆ±å¥½è€…ç”¨çˆ±å‘ç”µè‡ªè¡Œç»´æŠ¤ã€‚å…¶å®è¦å»è§£å†³çš„è¯ä¹Ÿæœ‰åŠæ³•ï¼Œè™½ç„¶ Electron å®˜æ–¹ç§»é™¤äº†è¿™ä¸ª APIï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å®‰è£…ç¬¬ä¸‰æ–¹åŒ… <code>@electron/remote/main</code> æ¥æ”¯æŒã€‚</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œä»¥ä¸‹æ˜¯ <code>redux-persist</code> çš„ç®€å•é…ç½®ä½¿ç”¨ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* store.ts */</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware, compose &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Store</span> <span class="keyword">from</span> <span class="string">&#x27;electron-store&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&#x27;redux-thunk&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; persistReducer, persistStore, <span class="title class_">PersistConfig</span> &#125; <span class="keyword">from</span> <span class="string">&quot;redux-persist&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> autoMergeLevel2 <span class="keyword">from</span> <span class="string">&quot;redux-persist/lib/stateReconciler/autoMergeLevel2&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> createElectronStorage <span class="keyword">from</span> <span class="string">&quot;redux-persist-electron-storage&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">&quot;./reducers&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RootState</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">persistConfig</span>: <span class="title class_">PersistConfig</span>&lt;<span class="title class_">RootState</span>&gt; = &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="attr">storage</span>: <span class="title function_">createElectronStorage</span>(&#123;</span><br><span class="line">    <span class="attr">electronStore</span>: <span class="keyword">new</span> <span class="title class_">Store</span>()</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">stateReconciler</span>: autoMergeLevel2,</span><br><span class="line">  <span class="attr">blacklist</span>: [<span class="string">&quot;status&quot;</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> persistedReducer = <span class="title function_">persistReducer</span>(persistConfig, rootReducer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">createStore</span>(</span><br><span class="line">  persistedReducer,</span><br><span class="line">  <span class="title function_">compose</span>(</span><br><span class="line">    <span class="title function_">applyMiddleware</span>(thunk),</span><br><span class="line">    (<span class="variable language_">window</span> <span class="keyword">as</span> <span class="built_in">any</span>).<span class="property">devToolsExtension</span> ? (<span class="variable language_">window</span> <span class="keyword">as</span> <span class="built_in">any</span>).<span class="title function_">devToolsExtension</span>() : <span class="function">(<span class="params">f: <span class="built_in">any</span></span>) =&gt;</span> f</span><br><span class="line">  )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> persistor = <span class="title function_">persistStore</span>(store <span class="keyword">as</span> <span class="built_in">any</span>);</span><br></pre></td></tr></table></figure><p>åœ¨ <code>App.tsx</code> ä¸­å¼•å…¥ï¼š</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; store, persistor &#125; <span class="keyword">from</span> <span class="string">&quot;./redux/store&quot;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">App</span>: <span class="title class_">React</span>.<span class="property">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">PersistGate</span> <span class="attr">loading</span>=<span class="string">&#123;</span>&lt;<span class="attr">Loading</span> /&gt;</span>&#125; persistor=&#123;persistor&#125;&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">ThemeProvider</span> <span class="attr">theme</span>=<span class="string">&#123;darkMode</span> ? <span class="attr">darkTheme</span> <span class="attr">:</span> <span class="attr">mainTheme</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.root&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">AppNav</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">main</span> <span class="attr">className</span>=<span class="string">&#123;styles.content&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.toolbar&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/home&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">HomePage</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    ...</span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">ThemeProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">PersistGate</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-é¡¹ç›®æ‰“åŒ…ï¼šelectron-builder">4. é¡¹ç›®æ‰“åŒ…ï¼šelectron-builder</h3><p>ä¸€ç›´ç”¨è¿™ä¸ªæ‰“åŒ… Electron åº”ç”¨ï¼ŒæŒºå¥½ç”¨çš„å·¥å…·ï¼Œæ”¯æŒå¤šå¹³å°(win / darwin / linuxâ€¦)ã€å¤šæ¶æ„(arm64 / amd / aarch64â€¦)ã€å¤šåŒ…æ ¼å¼(zip / exe / deb / AppImage / dmg / pkg / snap / nsisâ€¦)ï¼Œç”šè‡³æ˜¯åº”ç”¨æ‰“åŒ…æ›´æ–°ç­‰åŠŸèƒ½æ”¯æŒï¼Œæ€»ä¹‹éå¸¸å¼ºå¤§ã€‚</p><p>å®˜æ–¹æ–‡æ¡£è¿˜ç®—æ˜¯å†™çš„ç®€ä»‹æ˜äº†ï¼Œè¿™é‡Œç»™ä¸ª DOC åœ°å€ï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.electron.build/">electron-builder</a>ã€‚</p><p>å¯ä»¥å°† <code>electron-builder</code> çš„é…ç½®ä¸€åŒå†™å…¥ <code>package.json</code> æ–‡ä»¶ä¸­ï¼Œä¸è¿‡ä¸ºäº†é…ç½®åˆ†ç¦»åŒ–æ˜“äºç®¡ç†ä¹Ÿå¯å•ç‹¬ç¼–å†™ <code>electron-builder.json</code> é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">/* åŸºç¡€å…¬ç”¨é…ç½® */</span></span><br><span class="line">  <span class="attr">&quot;appId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;io.robertying.shadowsocks-electron&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;productName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Shadowsocks Electron&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;asar&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;copyright&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Â© 2020 nojsja&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">// æ˜¾å¼å£°æ˜éœ€è¦æ‰“åŒ…çš„é™æ€æ–‡ä»¶ç­‰</span></span><br><span class="line">    <span class="string">&quot;assets/**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;bin/**/*&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;extraFiles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">// æ˜¾å¼ç”Ÿæˆéœ€è¦æ’é™¤çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bin/$&#123;os&#125;/$&#123;arch&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bin&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;!.gitignore&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">/* mac å¹³å°æ‰“åŒ…é…ç½® */</span></span><br><span class="line">  <span class="attr">&quot;mac&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">// ç›®æ ‡æ‰“åŒ…æ ¼å¼</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dmg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;arch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;x64&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      ...</span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assets/icon.icns&quot;</span><span class="punctuation">,</span> <span class="comment">// åº”ç”¨å›¾æ ‡</span></span><br><span class="line">    <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;public.app-category.utilities&quot;</span><span class="punctuation">,</span> <span class="comment">// åº”ç”¨ç±»åˆ«</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">/* linux å¹³å°æ‰“åŒ…é…ç½® */</span></span><br><span class="line">  <span class="attr">&quot;linux&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assets/icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;AppImage&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;deb&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Network&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;executableName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shadowsocks-electron&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;deb&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// å¯¹åº” linux.target.deb çš„ç‹¬ç«‹é…ç½®</span></span><br><span class="line">    <span class="attr">&quot;depends&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">// å£°æ˜ deb å®‰è£…åŒ…çš„è½¯ä»¶ä¾èµ–</span></span><br><span class="line">      <span class="string">&quot;gconf2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;gconf-service&quot;</span><span class="punctuation">,</span> <span class="string">&quot;libnotify4&quot;</span><span class="punctuation">,</span> <span class="string">&quot;libappindicator1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;libxtst6&quot;</span><span class="punctuation">,</span> <span class="string">&quot;libnss3&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;shadowsocks-libev&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;publish&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>éœ€è¦<strong>é¢å¤–æ³¨æ„</strong>ï¼š</p><ul><li><p>Mac å¹³å°éœ€è¦ä½¿ç”¨ <code>icns</code> æ ¼å¼çš„å›¾æ ‡ï¼ŒWin éœ€è¦ <code>ico</code> æ ¼å¼çš„å›¾æ ‡ï¼ŒLinux åªè¦ <code>png</code> æ ¼å¼å³å¯ã€‚å¦‚æœæ ¼å¼ä¸å¯¹æˆ–æ˜¯æ–‡ä»¶æŸåå¯èƒ½å¯¼è‡´æ‰“åŒ…æŠ¥é”™ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ª <code>png</code> è½¬ <code>icns</code> çš„å·¥å…·<a target="_blank" rel="noopener external nofollow noreferrer" href="https://anyconv.com/png-to-icns-converter/">ç½‘ç«™</a>ã€‚</p></li><li><p>ç¬¬ä¸€æ¬¡æ‰“åŒ…æ—¶ npm ä¼šè‡ªåŠ¨ä¸‹è½½æ‰“åŒ…ç¯å¢ƒï¼Œå›½å†…ç½‘ç»œä½ æ‡‚å¾—ï¼Œå¾ˆå¯èƒ½ä¸€ç›´å¡ç€ä¸‹è½½å¤±è´¥ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­ç‰ˆæœ¬å· <code>13.4.0</code> å¯ä»¥æ”¹ä¸ºä½ çš„é¡¹ç›®ä¸­æ­£åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬å·ï¼š</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for china developers</span></span><br><span class="line">$: npm config <span class="built_in">set</span> electron_custom_dir <span class="string">&quot;13.4.0&quot;</span></span><br><span class="line">$: npm config <span class="built_in">set</span> electron_mirror http://npm.taobao.org/mirrors/electron/</span><br></pre></td></tr></table></figure><h3 id="5-å®¢æˆ·ç«¯è¿è¡Œæ—¥å¿—ç®¡ç†ï¼šwinston">5. å®¢æˆ·ç«¯è¿è¡Œæ—¥å¿—ç®¡ç†ï¼šwinston</h3><p>æ—¥å¿—åŠŸèƒ½é€šå¸¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ç¨‹åºå¿…ä¸å¯å°‘çš„æ¨¡å—ï¼Œå¯ä»¥ç”¨äºç”Ÿäº§ç¯å¢ƒè®°å½•é”™è¯¯å’Œå‘Šè­¦ï¼Œä»¥ä¾¿å¼€å‘è€…åœ¨æ”¶åˆ°ç”¨æˆ·åé¦ˆæ—¶è¿›è¡Œæ—¥å¿—åˆ†æå®šä½é—®é¢˜ã€‚</p><p>winston è¢«è®¾è®¡ä¸ºä¸€ä¸ªç®€å•ä¸”é€šç”¨çš„æ—¥å¿—åº“ï¼Œæ”¯æŒå¤šç§ä¼ è¾“å™¨ã€‚ ä¼ è¾“å™¨æœ¬è´¨ä¸Šæ˜¯æ—¥å¿—çš„å­˜å‚¨è®¾å¤‡ï¼Œæ¯ä¸ª winston æ—¥å¿—å®ä¾‹éƒ½å¯ä»¥åœ¨ä¸åŒçº§åˆ«é…ç½®å¤šä¸ªä¼ è¾“å™¨ã€‚ æ¯”å¦‚ï¼šå°†é”™è¯¯æ—¥å¿—æŒä¹…åŒ–å­˜å‚¨åœ¨çš„è¿œç¨‹ä½ç½®ï¼ˆå¦‚æ•°æ®åº“ï¼‰ï¼Œå¦å¤–æŠŠæ‰€æœ‰è¿è¡Œæ—¥å¿—éƒ½è¾“å‡ºåˆ°æ§åˆ¶å°æˆ–æœ¬åœ°æ–‡ä»¶ã€‚</p><p>è¿™é‡Œé…åˆ winston æ’ä»¶ <code>winston-daily-rotate-file</code> ä½¿ç”¨ï¼Œå®ƒå¯ä»¥æ›´ç»†ç²’åº¦åœ°è¿›è¡Œæ—¥å¿—åˆ†å‰²ã€æ—¥å¿—å­˜å‚¨æ–‡ä»¶åè‡ªå®šä¹‰ã€æ—¥å¿—å‹ç¼©ã€è¿‡æœŸæ—¥å¿—æ¸…é™¤ç­‰åŠŸèƒ½ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; app &#125; <span class="keyword">from</span> <span class="string">&quot;electron&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> winston, &#123; format &#125; <span class="keyword">from</span> <span class="string">&quot;winston&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> open <span class="keyword">from</span> <span class="string">&quot;open&quot;</span>;</span><br><span class="line"><span class="keyword">import</span>  <span class="title class_">DailyRotateFile</span> <span class="keyword">from</span> <span class="string">&#x27;winston-daily-rotate-file&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; combine, simple, colorize &#125; = format;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> logDir = app.<span class="title function_">getPath</span>(<span class="string">&quot;logs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> timestamp = <span class="title function_">format</span>(<span class="function">(<span class="params">info, opts</span>) =&gt;</span> &#123;</span><br><span class="line">  info.<span class="property">message</span> = <span class="string">`<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString()&#125;</span> - <span class="subst">$&#123;info.message&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">return</span> info;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">dailyTransport</span>: <span class="title class_">DailyRotateFile</span> = <span class="keyword">new</span> <span class="title class_">DailyRotateFile</span>(&#123;</span><br><span class="line">  <span class="attr">filename</span>: path.<span class="title function_">resolve</span>(logDir, <span class="string">&#x27;shadowsocks-electron-%DATE%.log&#x27;</span>), <span class="comment">// æ—¥å¿—æ–‡ä»¶åæ ¼å¼</span></span><br><span class="line">  <span class="attr">datePattern</span>: <span class="string">&#x27;YYYY-MM-DD&#x27;</span>, <span class="comment">// æ—¥æœŸæ ¼å¼</span></span><br><span class="line">  <span class="attr">zippedArchive</span>: <span class="literal">false</span>, <span class="comment">// å¯ç”¨å‹ç¼©</span></span><br><span class="line">  <span class="attr">maxSize</span>: <span class="string">&#x27;10m&#x27;</span>, <span class="comment">// å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§å®¹é‡</span></span><br><span class="line">  <span class="attr">maxFiles</span>: <span class="string">&#x27;30d&#x27;</span> <span class="comment">// æ—¥å¿—è¿‡æœŸæ—¶é—´</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logger = winston.<span class="title function_">createLogger</span>(&#123;</span><br><span class="line">  <span class="attr">level</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">  <span class="attr">transports</span>: [</span><br><span class="line">    dailyTransport</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&quot;production&quot;</span>) &#123;</span><br><span class="line">  logger.<span class="title function_">add</span>(</span><br><span class="line">    <span class="keyword">new</span> winston.<span class="property">transports</span>.<span class="title class_">Console</span>(&#123;</span><br><span class="line">      <span class="attr">format</span>: <span class="title function_">combine</span>(<span class="title function_">colorize</span>(), <span class="title function_">timestamp</span>(), <span class="title function_">simple</span>())</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> logger;</span><br></pre></td></tr></table></figure><h2 id="Core-Functions">Core Functions</h2><blockquote><p>å…³é”®åŠŸèƒ½è§£æ</p></blockquote><h3 id="1-è§£æ-Shadowsocks-ä¸“ç”¨åŠ å¯†é“¾æ¥">1. è§£æ Shadowsocks ä¸“ç”¨åŠ å¯†é“¾æ¥</h3><p>å®¢æˆ·ç«¯æ”¯æŒå°† shadowsocks åŠ å¯†é“¾æ¥å¦‚<code>ss://cmM0LW1kNTp4TTBtY09kOVFubjVAY240Lm15ZGFya2Nsb3VkLmluZm86MTI2MDA</code> è§£æä¸ºæœåŠ¡å™¨é…ç½®ã€‚è§£æ ss é“¾æ¥å…¶å®å¹¶ä¸å¤æ‚ï¼Œss åé¢çš„å­—ç¬¦ä¸²éƒ½æ˜¯ <code>base64</code> ç¼–ç ï¼Œä½¿ç”¨ Base64 è§£ç æˆæ­£å¸¸æ ¼å¼ <code>ss://method:password@server:port</code> ä¹‹åä½¿ç”¨æ­£åˆ™åŒ¹é…æå–å„ä¸ªå…³é”®å­—æ®µå³å¯ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Base64</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;js-base64&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="title function_">parseSSContent</span>(<span class="attr">uri</span>: string): <span class="title class_">Proxy</span> | <span class="literal">null</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">    <span class="comment">// Try legacy</span></span><br><span class="line">    <span class="keyword">let</span> legacyRegex = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">`^(<span class="subst">$&#123;ProxyURI.base64Pattern&#125;</span>)(#(.+))?$`</span>, <span class="string">&quot;gi&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> match = legacyRegex.<span class="title function_">exec</span>(uri)</span><br><span class="line">    <span class="keyword">if</span> (match &amp;&amp; match.<span class="property">length</span> &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="title class_">ProxyScheme</span>.<span class="property">SS</span>);</span><br><span class="line">      proxy.<span class="property">type</span> = <span class="string">&#x27;ss&#x27;</span>;</span><br><span class="line">      proxy.<span class="property">remark</span> = match[<span class="number">3</span>];</span><br><span class="line">      <span class="keyword">let</span> core = <span class="title class_">Base64</span>.<span class="title function_">decode</span>(match[<span class="number">1</span>]);</span><br><span class="line">      <span class="comment">// No &quot;$&quot; at the end is due to ShadowsocksX-NG compatibility issue</span></span><br><span class="line">      <span class="comment">// ShadowsocksX-NG will append a remark like &quot;?remark=xxxxx&quot;</span></span><br><span class="line">      <span class="keyword">let</span> mainRegex = <span class="regexp">/^(.+?):(.+)@(.+?):(\d+)/gi</span></span><br><span class="line">      <span class="keyword">let</span> coreComps = mainRegex.<span class="title function_">exec</span>(core);</span><br><span class="line">      <span class="keyword">if</span> (coreComps &amp;&amp; coreComps[<span class="number">1</span>] &amp;&amp; coreComps[<span class="number">2</span>] &amp;&amp; coreComps[<span class="number">3</span>] &amp;&amp; coreComps[<span class="number">4</span>]) &#123;</span><br><span class="line">        proxy.<span class="property">host</span> = coreComps[<span class="number">3</span>];</span><br><span class="line">        proxy.<span class="property">port</span> = <span class="title class_">Number</span>(coreComps[<span class="number">4</span>]);</span><br><span class="line">        proxy.<span class="property">authscheme</span> = coreComps[<span class="number">1</span>].<span class="title function_">toLowerCase</span>();</span><br><span class="line">        proxy.<span class="property">password</span> = coreComps[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-å°†å·²æœ‰çš„æœåŠ¡å™¨é…ç½®ç”ŸæˆäºŒç»´ç å›¾ç‰‡è¿›è¡Œåˆ†äº«">2. å°†å·²æœ‰çš„æœåŠ¡å™¨é…ç½®ç”ŸæˆäºŒç»´ç å›¾ç‰‡è¿›è¡Œåˆ†äº«</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/share.png" alt="share"></p><p>ä¸Šä¸€æ­¥è§£ææˆåŠŸåå¯ä»¥å¾—åˆ°æœåŠ¡å™¨é…ç½®ï¼Œå®ä¾‹æ•°æ®å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">     <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cn2.mydarkcloud.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;serverHost&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cn2.mydarkcloud.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;serverPort&quot;</span><span class="punctuation">:</span> <span class="number">12322</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xM0mcOd9Qn33&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;encryptMethod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rc4-md5&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ss&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¦åšäºŒç»´ç åˆ†äº«åŠŸèƒ½çš„è¯éœ€è¦å°†é…ç½®ä¿¡æ¯ç»„è£…æˆæ­£å¸¸æ ¼å¼ <code>ss://method:password@server:port</code>ï¼Œç„¶åç¼–ç æˆ <code>Base64</code> åŠ å¯†é“¾æ¥ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Base64</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;js-base64&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="title function_">generateSS</span>(<span class="attr">host</span>: string, <span class="attr">port</span>: number, <span class="attr">method</span>: string, <span class="attr">password</span>: string, remark?: string, <span class="attr">isSIP002</span>: boolean = <span class="literal">true</span>): string &#123;</span><br><span class="line">    <span class="keyword">let</span> rawURI = method.<span class="title function_">toLowerCase</span>() + <span class="string">&quot;:&quot;</span> + password + <span class="string">&quot;@&quot;</span> + host + <span class="string">&quot;:&quot;</span> + port;</span><br><span class="line">    <span class="keyword">let</span> uri = <span class="title class_">ProxyScheme</span>.<span class="property">SS</span> + <span class="title class_">Base64</span>.<span class="title function_">encode</span>(rawURI);</span><br><span class="line">    <span class="keyword">if</span> (remark) &#123;</span><br><span class="line">      uri += <span class="string">&quot;#&quot;</span> + remark;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> uri;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°åŠ å¯†é“¾æ¥åï¼Œä½¿ç”¨ <code>qrcode</code> åº“å°†å…¶è¾“å‡ºæˆå‰ç«¯å¯ç›´æ¥å±•ç¤ºçš„ <code>dataURL</code> æ•°æ®æ ¼å¼ï¼Œç„¶åç•Œé¢ä¸Šç›´æ¥èµ‹å€¼ç»™ <code>img</code> æ ‡ç­¾çš„ <code>src</code> å±æ€§å³å¯ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">QRCode</span> <span class="keyword">from</span> <span class="string">&#x27;qrcode&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> result = &#123;</span><br><span class="line">  <span class="attr">code</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">result</span>: &#123;</span><br><span class="line">    <span class="attr">dataUrl</span>: <span class="string">&#x27;</span></span><br><span class="line"><span class="string">    msg: &#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">QRCode</span>.<span class="title function_">toDataURL</span>(url, <span class="keyword">function</span> (<span class="params">err, _dataURL</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">    result.<span class="property">result</span>.<span class="property">dataUrl</span> = _dataURL;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    result.<span class="property">code</span> = <span class="number">500</span>;</span><br><span class="line">    result.<span class="property">result</span>.<span class="property">msg</span> = err.<span class="title function_">toString</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">resolve</span>(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="3-è¯»å–äºŒç»´ç å¯¼å…¥-Shadowsocks-æœåŠ¡å™¨é…ç½®">3. è¯»å–äºŒç»´ç å¯¼å…¥ Shadowsocks æœåŠ¡å™¨é…ç½®</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/add_server.gif" alt="add_server"></p><p>æ‰«æå±å¹•äºŒç»´ç å¯¼å…¥åŠŸèƒ½å®ç°èµ·æ¥ç¨å¤æ‚äº›ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼šå…ˆä½¿ç”¨ Electron è‡ªå¸¦ <code>desktopCapture</code> API è·å–æ¡Œé¢æˆªå›¾æ–‡ä»¶ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; desktopCapturer &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="comment">/* è·å–æ¡Œé¢æˆªå›¾ */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getScreenCapturedResources</span>(<span class="params"></span>): <span class="title class_">Promise</span>&lt;<span class="title class_">Electron</span>.<span class="property">DesktopCapturerSource</span>[]&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> desktopCapturer.<span class="title function_">getSources</span>(&#123;</span><br><span class="line">    <span class="attr">types</span>: [<span class="string">&#x27;screen&#x27;</span>],</span><br><span class="line">    <span class="attr">thumbnailSize</span>: &#123;</span><br><span class="line">      <span class="attr">width</span>: <span class="variable language_">window</span>.<span class="property">screen</span>.<span class="property">width</span> * <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>,</span><br><span class="line">      <span class="attr">height</span>: <span class="variable language_">window</span>.<span class="property">screen</span>.<span class="property">height</span> * <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼šå°†æˆªå›¾æ•°æ®è½¬æ¢æˆ bitmap ä½å›¾æ ¼å¼(å­˜å‚¨åƒç´ ç‚¹é¢œè‰²å’Œé€æ˜åº¦çš„æ•°ç»„[r,g,b,a â€¦])ï¼Œç„¶åä½¿ç”¨ <code>jsqr</code> åº“è§£æä½å›¾ä¸­çš„äºŒç»´ç ä¿¡æ¯ï¼Œæœ€ç»ˆä¼šå¾—åˆ°äºŒç»´ç ä½äºå±å¹•ä¸­çš„åæ ‡ã€å®½åº¦å’Œæ–‡æœ¬å€¼ç­‰ä¿¡æ¯ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* è§£æä½å›¾æ•°æ® */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getQrCodeFromScreenResources = (callback?: <span class="function">(<span class="params">added: <span class="built_in">boolean</span></span>) =&gt;</span> <span class="built_in">void</span>): <span class="title class_">ThunkAction</span>&lt;<span class="built_in">void</span>, <span class="title class_">RootState</span>, <span class="built_in">unknown</span>, <span class="title class_">AnyAction</span>&gt; =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">getScreenCapturedResources</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">resources: Electron.DesktopCapturerSource[]</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// å¯èƒ½æœ‰å¤šä¸ªå±å¹•èµ„æº</span></span><br><span class="line">      <span class="keyword">if</span> (resources &amp;&amp; resources.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">qrs</span>: &#123;<span class="attr">x</span>: <span class="built_in">number</span>, <span class="attr">y</span>: <span class="built_in">number</span>, <span class="attr">width</span>: <span class="built_in">number</span>, <span class="attr">height</span>: <span class="built_in">number</span>&#125;[] = [];</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">values</span>: <span class="built_in">string</span>[] = [];</span><br><span class="line">        resources.<span class="title function_">forEach</span>(<span class="function"><span class="params">resource</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> size = resource.<span class="property">thumbnail</span>.<span class="title function_">getSize</span>();</span><br><span class="line">          <span class="comment">// ä½¿ç”¨æˆªå›¾çš„ä½å›¾ä¿¡æ¯è¿›è¡Œè§£æ</span></span><br><span class="line">          <span class="keyword">const</span> capturedData = <span class="title function_">jsqr</span>(resource.<span class="property">thumbnail</span>.<span class="title function_">getBitmap</span>() <span class="keyword">as</span> <span class="built_in">any</span>, size.<span class="property">width</span>, size.<span class="property">height</span>);</span><br><span class="line">          <span class="keyword">if</span> (capturedData &amp;&amp; capturedData.<span class="property">data</span>) &#123;</span><br><span class="line">            values.<span class="title function_">push</span>(capturedData.<span class="property">data</span>);</span><br><span class="line">            <span class="comment">// ä¿å­˜å¤šä¸ªäºŒç»´ç çš„åæ ‡ã€å®½é«˜å’Œæ–‡æœ¬å€¼ä¿¡æ¯</span></span><br><span class="line">            qrs.<span class="title function_">push</span>(&#123;</span><br><span class="line">              <span class="attr">x</span>: capturedData.<span class="property">location</span>.<span class="property">topLeftCorner</span>.<span class="property">x</span>,</span><br><span class="line">              <span class="attr">y</span>: capturedData.<span class="property">location</span>.<span class="property">topLeftCorner</span>.<span class="property">y</span>,</span><br><span class="line">              <span class="attr">width</span>: capturedData.<span class="property">location</span>.<span class="property">topRightCorner</span>.<span class="property">x</span> - capturedData.<span class="property">location</span>.<span class="property">topLeftCorner</span>.<span class="property">x</span>,</span><br><span class="line">              <span class="attr">height</span>: capturedData.<span class="property">location</span>.<span class="property">bottomLeftCorner</span>.<span class="property">y</span> - capturedData.<span class="property">location</span>.<span class="property">topLeftCorner</span>.<span class="property">y</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// ä¿å­˜ qrs äºŒç»´ç æ•°æ®å¹¶å‘é€æ•°æ®åˆ°ä¸»è¿›ç¨‹è¿›è¡Œå…¶å®ƒæ“ä½œ</span></span><br><span class="line">        ...</span><br><span class="line">        callback &amp;&amp; <span class="title function_">callback</span>(!!qrs.<span class="property">length</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        callback &amp;&amp; <span class="title function_">callback</span>(<span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼šå‘é€äºŒç»´ç æ•°æ®åˆ°ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹æ ¹æ®åæ ‡å’Œå®½é«˜ä¿¡æ¯ç”ŸæˆåŠé€æ˜çš„å…¨å±çª—å£(æˆªå›¾é®ç½©å±‚)ï¼Œå¹¶åœ¨é€æ˜çª—å£åŠ è½½çš„ js æ–‡ä»¶ä¸­æ ¹æ®äºŒç»´ç åæ ‡ä¿¡æ¯ç”¨ <code>canvas</code> ç»˜åˆ¶é«˜äº®æ•è·åŒºåŸŸï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ------ ä¸»è¿›ç¨‹ä¸­åˆ›å»ºé€æ˜çª—å£ ------ */</span></span><br><span class="line"><span class="keyword">import</span> &#123; app, <span class="title class_">BrowserWindow</span> screen &#125; <span class="keyword">from</span> <span class="string">&quot;electron&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> screenSize = screen.<span class="title function_">getPrimaryDisplay</span>().<span class="property">workAreaSize</span>;</span><br><span class="line"><span class="keyword">const</span> twin = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: screenSize.<span class="property">width</span>,</span><br><span class="line">    <span class="attr">height</span>: screenSize.<span class="property">height</span>,</span><br><span class="line">    <span class="attr">transparent</span>: <span class="literal">true</span>, <span class="comment">// é€æ˜</span></span><br><span class="line">    <span class="attr">alwaysOnTop</span>: <span class="literal">true</span>, <span class="comment">// ç½®é¡¶</span></span><br><span class="line">    <span class="attr">fullscreen</span>: <span class="literal">true</span>, <span class="comment">// å…¨å±</span></span><br><span class="line">    <span class="attr">frame</span>: <span class="literal">false</span>, <span class="comment">// æ— è¾¹æ¡†</span></span><br><span class="line">    <span class="attr">titleBarStyle</span>: <span class="string">&#x27;hidden&#x27;</span>, <span class="comment">// éšè—æ ‡é¢˜æ </span></span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br><span class="line">twin.<span class="title function_">loadURL</span>(<span class="string">&#x27;path/to/html&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* ------ æ¸²æŸ“è¿›ç¨‹ä¸­ç»˜åˆ¶é«˜äº®äºŒç»´ç åŒºåŸŸ ------ */</span></span><br><span class="line"><span class="keyword">const</span> &#123; ipcRenderer &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> screenWidth = <span class="variable language_">window</span>.<span class="property">screen</span>.<span class="property">availWidth</span> * <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>;</span><br><span class="line"><span class="keyword">const</span> screenHeight = <span class="variable language_">window</span>.<span class="property">screen</span>.<span class="property">availHeight</span> * <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>;</span><br><span class="line"><span class="keyword">const</span> $drawer = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#drawer&#x27;</span>);</span><br><span class="line">$drawer.<span class="property">width</span> = screenWidth;</span><br><span class="line">$drawer.<span class="property">height</span> = screenHeight;</span><br><span class="line"><span class="keyword">if</span> (!drawer) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ctx = drawer.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;x, y, width, height&#125; = p;</span><br><span class="line"><span class="keyword">if</span> (ctx) &#123;</span><br><span class="line">  <span class="comment">// å…¨å±å¡«å……åŠé€æ˜èƒŒæ™¯è‰²</span></span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;rgba(0, 0, 0, .3)&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>, <span class="number">0</span>, drawer.<span class="property">width</span>, drawer.<span class="property">height</span>);</span><br><span class="line">  <span class="comment">// é«˜äº®äºŒç»´ç æ•è·åŒºåŸŸ</span></span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;rgba(255, 0, 0, .4)&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(x, y, width, height);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-å¤šå¹³å°åŠŸèƒ½é€‚é…ä¹‹-shadowsocks-libev-åº“çš„ä¾èµ–å¤„ç†">4. å¤šå¹³å°åŠŸèƒ½é€‚é…ä¹‹ <code>shadowsocks-libev</code> åº“çš„ä¾èµ–å¤„ç†</h3><p>æœ¬æ¡Œé¢åº”ç”¨ä¸»è¦ä½¿ç”¨ <code>shadowsocks-libev</code> è·¨å¹³å°åº“è¿›è¡Œ proxy çš„ç®¡ç†ã€‚</p><ul><li><p>Ubuntu20.04 <strong>deb</strong> æ„å»ºæ–¹å¼ä¸­ï¼šç”±äºä¾èµ–åº“å¯ä»¥ç›´æ¥ä»å®˜æ–¹ <code>apt</code> è½¯ä»¶æºä¸­å®‰è£…ï¼Œå› æ­¤ä¸ç”¨åœ¨åº”ç”¨å†…éƒ¨æä¾›äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåªéœ€åœ¨ <code>electron-builder.json</code> ä¸­å£°æ˜ <code>deb</code> å­—æ®µçš„ä¾èµ–é¡¹ç›®å³å¯ï¼Œç”¨æˆ·å®‰è£… deb å®‰è£…åŒ…çš„æ—¶å€™ä¼šè‡ªåŠ¨ä»è½¯ä»¶æºå•†åº—ä¸‹è½½å¯¹åº”çš„ä¾èµ–ï¼Œå‚è€ƒä¸Šæ–‡ <code>electron-builder.json</code> è¯´æ˜ã€‚</p></li><li><p>Ubuntu20.04 <strong>AppImage</strong> æ„å»ºæ–¹å¼ä¸­ï¼šéœ€è¦å°†ç”¨åˆ°çš„ <code>ss-local</code> å‘½ä»¤çš„äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶é›†æˆåˆ°åŒ…å†…ï¼Œå¹¶åœ¨æ‰§è¡Œå‘½ä»¤æ—¶æä¾›æ˜ç¡®çš„äºŒè¿›åˆ¶æ–‡ä»¶ç»å¯¹åœ°å€ï¼Œå¦‚ï¼š<code>/path/to/ss-local</code>ã€‚</p></li><li><p>Mac <strong>dmg / zip</strong> æ„å»ºæ–¹å¼ä¸­ï¼šMac ä¸­è™½ç„¶ä¹Ÿèƒ½é€šè¿‡åŒ…ç®¡ç†å™¨ <code>brew</code> æ¥å®‰è£…ï¼š<code>brew install shadowsocks-libev</code>ï¼Œä½†æ˜¯è€ƒè™‘åˆ° <code>brew</code> æœ¬èº«å¹¶ä¸å±äº Mac æ“ä½œç³»ç»Ÿå¼€å°å³ç”¨çš„åº”ç”¨ï¼Œå¯èƒ½æœ‰äº›ç”¨æˆ· Mac æœºæ²¡æœ‰å®‰è£…ï¼Œå¹¶ä¸”å›½å†…ç½‘ç»œç¯å¢ƒä½ æ‡‚å¾—ï¼Œæ™®é€šç”¨æˆ·å®‰è£…å®ƒå¯èƒ½ä¼šç½‘ç»œé”™è¯¯ã€‚å› æ­¤æ„å»ºåŒ…ä¸­é»˜è®¤é›†æˆäº† <code>shadowsocks-libev</code> åº“ä¸­éœ€è¦ç”¨åˆ°çš„ <code>ss-local</code> äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯¦è§é¡¹ç›®è·¯å¾„ï¼š<code>/bin/darwin/x64/ss-local</code>ã€‚</p></li></ul><p>ä»¥ä¸‹æ˜¯ç¨‹åºè¿è¡Œæ—¶è·å– <code>ss-local</code> å¯æ‰§è¡Œæ–‡ä»¶åœ°å€çš„å¤šå¹³å°å…¼å®¹å¤„ç†ä»£ç ä½œä¸ºå‚è€ƒï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æœç´¢ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­é…ç½®çš„ç›®å½•ï¼Œç”Ÿæˆç›®æ ‡å¯æ‰§è¡Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getBinPath = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> fullpath = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">  <span class="keyword">const</span> paths = (process.<span class="property">env</span>.<span class="property">PATH</span> <span class="keyword">as</span> <span class="built_in">string</span>).<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">name: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (fullpath.<span class="title function_">get</span>(name)) &#123;</span><br><span class="line">      <span class="keyword">return</span> fullpath.<span class="title function_">get</span>(name)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; paths.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(path.<span class="title function_">join</span>(paths[i], name))) &#123;</span><br><span class="line">        fullpath.<span class="title function_">set</span>(name, path.<span class="title function_">join</span>(paths[i], name));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fullpath.<span class="title function_">get</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è·å– ss-local æ‰§è¡Œæ–‡ä»¶åœ°å€ */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getSSLocalBinPath</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (os.<span class="title function_">platform</span>()) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;linux&#x27;</span>:</span><br><span class="line">      <span class="comment">// ä»ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­åŒ¹é…è·¯å¾„</span></span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">getBinPath</span>(<span class="string">&#x27;ss-local&#x27;</span>);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;darwin&#x27;</span>:</span><br><span class="line">      <span class="comment">// ä½¿ç”¨æ‰‹åŠ¨é›†æˆçš„ ss-local æ–‡ä»¶</span></span><br><span class="line">      <span class="keyword">return</span> path.<span class="title function_">join</span>(app.<span class="title function_">getAppPath</span>(), <span class="string">`bin/darwin/x64/ss-local`</span>);</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">getBinPath</span>(<span class="string">&#x27;ss-local&#x27;</span>) ?? <span class="string">&#x27;ss-local&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-Electron-è°ƒç”¨-shadowsocks-libev-åº“è¿æ¥æœåŠ¡å™¨">5. Electron è°ƒç”¨ <code>shadowsocks-libev</code> åº“è¿æ¥æœåŠ¡å™¨</h3><p>ä¸Šä¸€æ­¥è¯´æ˜äº†ä½¿ç”¨ <code>ss-local</code> å‘½ä»¤ä¹‹å‰æ‰€åšçš„å…¼å®¹å¤„ç†ï¼Œç°åœ¨éœ€è¦ä½¿ç”¨ <code>ss-local</code> å‘½ä»¤ (shadowsocks å®¢æˆ·ç«¯) æ¥è¿æ¥æˆ‘ä»¬çš„æœåŠ¡å™¨äº†ã€‚Electron æ‰§è¡Œå‘½ä»¤é¦–å…ˆæƒ³åˆ°çš„æ˜¯ä»€ä¹ˆï¼Ÿæ²¡é”™å°±æ˜¯ Node.js çš„ <a target="_blank" rel="noopener external nofollow noreferrer" href="http://nodejs.cn/api/child_process.html"><code>child_process</code></a> æ¨¡å—ï¼Œå®ƒæä¾›äº†å¤šç§æ–¹å¼ç”¨äº Node.js ä¸»è¿›ç¨‹å¼€å¯å­è¿›ç¨‹æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å’Œå¯æ‰§è¡Œæ–‡ä»¶ï¼š</p><ul><li><strong>spawn</strong>ï¼šchild_process.spawn() æ–¹æ³•ä½¿ç”¨ç»™å®šçš„ command å’Œ args ä¸­çš„å‘½ä»¤è¡Œå‚æ•°è¡ç”Ÿæ–°è¿›ç¨‹ã€‚</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ls = <span class="title function_">spawn</span>(<span class="string">&#x27;ls&#x27;</span>, [<span class="string">&#x27;-lh&#x27;</span>, <span class="string">&#x27;/usr&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">ls.<span class="property">stdout</span>.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`stdout: <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ls.<span class="property">stderr</span>.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`stderr: <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ls.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">(<span class="params">code</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`child process exited with code <span class="subst">$&#123;code&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>exec</strong>: è¡ç”Ÿ shellï¼Œç„¶ååœ¨è¯¥ shell ä¸­æ‰§è¡Œ commandï¼Œç¼“å†²ä»»ä½•ç”Ÿæˆçš„è¾“å‡ºã€‚</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; exec &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"><span class="title function_">exec</span>(<span class="string">&#x27;cat *.js missing_file | wc -l&#x27;</span>, <span class="function">(<span class="params">error, stdout, stderr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`exec error: <span class="subst">$&#123;error&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`stdout: <span class="subst">$&#123;stdout&#125;</span>`</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`stderr: <span class="subst">$&#123;stderr&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>execFile</strong>ï¼šç±»ä¼¼äº exec()ï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹å®ƒä¼šç›´æ¥è¡ç”Ÿå‘½ä»¤è€Œä¸å…ˆè¡ç”Ÿshellã€‚exec() å’Œ execFile() ä¹‹é—´åŒºåˆ«çš„é‡è¦æ€§å¯èƒ½å› å¹³å°è€Œå¼‚ï¼Œåœ¨ Unix ç±»å‹çš„æ“ä½œç³»ç»Ÿä¸Šï¼ŒexecFile() å¯ä»¥æ›´é«˜æ•ˆï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šè¡ç”Ÿ shellã€‚ä½†æ˜¯åœ¨ Windows ä¸Šï¼Œ .bat å’Œ .cmd æ–‡ä»¶åœ¨æ²¡æœ‰ç»ˆç«¯çš„æƒ…å†µä¸‹ä¸èƒ½è‡ªè¡Œæ‰§è¡Œï¼Œå› æ­¤æ— æ³•ä½¿ç”¨ execFile() å¯åŠ¨ã€‚å½“åœ¨ Windows ä¸Šè¿è¡Œæ—¶ï¼Œè¦è°ƒç”¨ .bat å’Œ .cmd æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨è®¾ç½®äº† shell é€‰é¡¹çš„ child_process.spawn()ã€child_process.exec() æˆ–è¡ç”Ÿ cmd.exe å¹¶å°† .bat æˆ– .cmd æ–‡ä»¶ä½œä¸ºå‚æ•°ä¼ å…¥ï¼ˆä¹Ÿå°±æ˜¯ shell é€‰é¡¹å’Œ child_process.exec() æ‰€åšçš„ï¼‰ã€‚</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; execFile &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> child = <span class="title function_">execFile</span>(<span class="string">&#x27;node&#x27;</span>, [<span class="string">&#x27;--version&#x27;</span>], <span class="function">(<span class="params">error, stdout, stderr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="keyword">throw</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(stdout);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>fork</strong>ï¼šchild_process.fork() æ–¹æ³•æ˜¯ child_process.spawn() çš„ç‰¹ä¾‹ï¼Œä¸“é—¨ç”¨äºè¡ç”Ÿæ–°çš„ Node.js è¿›ç¨‹ã€‚ ä¸ child_process.spawn() ä¸€æ ·ï¼Œè¿”å› ChildProcess å¯¹è±¡ã€‚ è¿”å›çš„ ChildProcess å°†æœ‰é¢å¤–çš„å†…ç½®é€šä¿¡é€šé“ï¼Œå…è®¸æ¶ˆæ¯åœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´æ¥å›ä¼ é€’ã€‚æ³¨æ„åˆ›å»ºä¸ªæ¯ä¸ªå­è¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„å†…å­˜ï¼Œå…·æœ‰è‡ªå·±çš„ V8 å®ä¾‹ï¼Œç”±äºéœ€è¦é¢å¤–çš„èµ„æºåˆ†é…ï¼Œä¸å»ºè®®è¡ç”Ÿå¤§é‡å­ Node.js è¿›ç¨‹ã€‚</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (process.<span class="property">argv</span>[<span class="number">2</span>] === <span class="string">&#x27;child&#x27;</span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello from <span class="subst">$&#123;process.argv[<span class="number">2</span>]&#125;</span>!`</span>);</span><br><span class="line">  &#125;, <span class="number">1_000</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; fork &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line">  <span class="keyword">const</span> &#123; signal &#125; = controller;</span><br><span class="line">  <span class="keyword">const</span> child = <span class="title function_">fork</span>(__filename, [<span class="string">&#x27;child&#x27;</span>], &#123; signal &#125;);</span><br><span class="line">  child.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ§åˆ¶å™¨ä¸­æ­¢ï¼Œåˆ™è¿™å°†åœ¨ err ä¸º AbortError çš„æƒ…å†µä¸‹è¢«è°ƒç”¨</span></span><br><span class="line">  &#125;);</span><br><span class="line">  controller.<span class="title function_">abort</span>(); <span class="comment">// åœæ­¢å­è¿›ç¨‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤é¡¹ç›®ä¸­ä½¿ç”¨ <code>spawn</code> æ–¹å¼åˆ›å»ºå­è¿›ç¨‹æ¥æ‰§è¡Œ <code>ss-local</code> å‘½ä»¤è¿æ¥æœåŠ¡å™¨ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> spawnClient = <span class="keyword">async</span> (<span class="attr">config</span>: <span class="title class_">Config</span>, <span class="attr">settings</span>: <span class="title class_">Settings</span>) : <span class="title class_">Promise</span>&lt;&#123;<span class="attr">code</span>: <span class="built_in">number</span>, <span class="attr">result</span>: <span class="built_in">any</span>&#125;&gt; =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> sslocalPath = <span class="title function_">getSSLocalBinPath</span>();</span><br><span class="line">  <span class="keyword">const</span> args = [</span><br><span class="line">    <span class="string">&quot;-s&quot;</span>,</span><br><span class="line">    config.<span class="property">serverHost</span>,</span><br><span class="line">    <span class="string">&quot;-p&quot;</span>,</span><br><span class="line">    config.<span class="property">serverPort</span>.<span class="title function_">toString</span>(),</span><br><span class="line">    <span class="string">&quot;-l&quot;</span>,</span><br><span class="line">    settings.<span class="property">localPort</span>.<span class="title function_">toString</span>(),</span><br><span class="line">    <span class="string">&quot;-k&quot;</span>,</span><br><span class="line">    config.<span class="property">password</span>,</span><br><span class="line">    <span class="string">&quot;-m&quot;</span>,</span><br><span class="line">    config.<span class="property">encryptMethod</span>,</span><br><span class="line">    config.<span class="property">udp</span> ? <span class="string">&quot;-u&quot;</span> : <span class="string">&quot;&quot;</span>,</span><br><span class="line">    config.<span class="property">fastOpen</span> ? <span class="string">&quot;--fast-open&quot;</span> : <span class="string">&quot;&quot;</span>,</span><br><span class="line">    config.<span class="property">noDelay</span> ? <span class="string">&quot;--no-delay&quot;</span> : <span class="string">&quot;&quot;</span>,</span><br><span class="line">    config.<span class="property">plugin</span> ? <span class="string">&quot;--plugin&quot;</span> : <span class="string">&quot;&quot;</span>,</span><br><span class="line">    config.<span class="property">plugin</span> ?? <span class="string">&quot;&quot;</span>,</span><br><span class="line">    config.<span class="property">pluginOpts</span> ? <span class="string">&quot;--plugin-opts&quot;</span> : <span class="string">&quot;&quot;</span>,</span><br><span class="line">    config.<span class="property">pluginOpts</span> ?? <span class="string">&quot;&quot;</span>,</span><br><span class="line">    settings.<span class="property">verbose</span> ? <span class="string">&quot;-v&quot;</span> : <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-t&quot;</span>,</span><br><span class="line">    (config.<span class="property">timeout</span> ?? <span class="string">&quot;60&quot;</span>).<span class="title function_">toString</span>()</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`check port <span class="subst">$&#123;settings.localPort&#125;</span> usage...`</span>);</span><br><span class="line">    ssLocal = <span class="title function_">spawn</span>(</span><br><span class="line">      sslocalPath,</span><br><span class="line">      args.<span class="title function_">filter</span>(<span class="function"><span class="params">arg</span> =&gt;</span> arg !== <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    ssLocal.<span class="property">stdout</span>?.<span class="title function_">once</span>(<span class="string">&quot;data&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">&quot;Started ss-local&quot;</span>);</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">&quot;Set proxy on&quot;</span>);</span><br><span class="line">          ...</span><br><span class="line">      connected = <span class="literal">true</span>;</span><br><span class="line">      mainWindow?.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&quot;connected&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">      <span class="title function_">resolve</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="attr">result</span>: <span class="literal">null</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    ssLocal.<span class="property">stdout</span>?.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(data);</span><br><span class="line">    &#125;);</span><br><span class="line">    ssLocal.<span class="title function_">on</span>(<span class="string">&quot;error&quot;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      logger.<span class="title function_">error</span>(err);</span><br><span class="line">    &#125;);</span><br><span class="line">    ssLocal.<span class="title function_">on</span>(<span class="string">&quot;exit&quot;</span>, <span class="keyword">async</span> (code, signal) =&gt; &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">`Exited ss-local with code <span class="subst">$&#123;code&#125;</span> or signal <span class="subst">$&#123;signal&#125;</span>`</span>);</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">&quot;Set proxy off&quot;</span>);</span><br><span class="line">      ...</span><br><span class="line">      connected = <span class="literal">false</span>;</span><br><span class="line">      <span class="title class_">MessageChannel</span>.<span class="title function_">sendTo</span>(mainWindow?.<span class="property">id</span> || <span class="number">1</span>, <span class="string">&#x27;connected&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">      ssLocal = <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="6-å¤šå¹³å°åŠŸèƒ½é€‚é…ä¹‹è®¾ç½®ç³»ç»Ÿ-proxy-å’Œ-pac-æœåŠ¡">6. å¤šå¹³å°åŠŸèƒ½é€‚é…ä¹‹è®¾ç½®ç³»ç»Ÿ proxy å’Œ pac æœåŠ¡</h3><p>å®¢æˆ·ç«¯ä¸­å¯ä»¥åˆ‡æ¢<strong>å…¨å±€ proxy</strong> å’Œ <strong>pac æ¨¡å¼</strong>ï¼Œå…¨å±€å³ç³»ç»Ÿä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºéƒ½èµ° proxy æµé‡ã€‚è€Œ pac åˆ™æ˜¯ä¸€ç§æ›´åŠ æ™ºèƒ½åŒ–çš„æ¨¡å¼ï¼Œé€šè¿‡é…ç½® pac æ–‡ä»¶çš„åœ°å€(http / fs åè®®)ï¼Œå®ç°ç³»ç»Ÿæµé‡æŒ‰ç…§ pac ä¸­å£°æ˜çš„è§„åˆ™è¿›è¡Œæ™ºèƒ½åŒ–åˆ†æµå¤„ç†ï¼Œåªå°†æˆ‘ä»¬ä¸èƒ½ç›´æ¥è®¿é—®çš„åŸŸåé€šè¿‡ proxy è½¬å‘ã€‚</p><ul><li>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Ubuntu æ“ä½œç³»ç»Ÿçš„è¯å¯ä»¥ä¾æ¬¡æ‰“å¼€ï¼š<code>è®¾ç½® - ç½‘ç»œ - ç½‘ç»œDaiLi(æ‹¼éŸ³æ‰‹åŠ¨å’Œè°)</code>ï¼Œé‡Œé¢å¯ä»¥é€‰æ‹©ï¼š<code>è‡ªåŠ¨ / æ‰‹åŠ¨ / ç¦ç”¨</code> ä¸‰ç§æ¨¡å¼ï¼Œå…¶ä¸­<strong>è‡ªåŠ¨</strong>å³ä¸º pac æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¡«å…¥åœ¨çº¿æˆ–æœ¬åœ°pacæ–‡ä»¶çš„åœ°å€ï¼Œä¾‹å¦‚ï¼š<code>http://localhost:1090/proxy.pac</code>ï¼Œç„¶åç³»ç»Ÿå°±ä¼šæ™ºèƒ½åŒ–åˆ†é…æµé‡äº†ï¼›<strong>æ‰‹åŠ¨</strong>å°±æ˜¯å…¨å±€ proxyï¼Œé‡Œé¢å¯ä»¥é…ç½®å„ç§ proxy çš„åœ°å€(http / https / socks / ftp)ï¼Œå¦‚ï¼š<code>socks5://127.0.0.1:1080</code>ï¼›<strong>ç¦ç”¨</strong>ä¸ç”¨å¤šè¯´å°±æ˜¯ç¦æ­¢ç³»ç»Ÿ proxyï¼Œç›´æ¥æ ¹æ®è®¿é—®ç›®æ ‡èµ° dns ç³»ç»ŸæŸ¥è¯¢åˆ°çš„ IP åœ°å€ã€‚</li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/system_proxy.png" alt="system_proxy"></p><ul><li>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Mac æ“ä½œç³»ç»Ÿçš„è¯å…¶å®ä¹Ÿå¤§åŒå°å¼‚ï¼Œå¯ä»¥ä»ï¼š<code>ç³»ç»Ÿåå¥½è®¾ç½® - ç½‘ç»œ - é«˜çº§ - DaiLi(æ‹¼éŸ³æ‰‹åŠ¨å’Œè°)</code> å¤„æ‰¾åˆ°ç›¸å…³è®¾ç½®ã€‚</li></ul><p>å®¢æˆ·ç«¯å®ç°çš„åŠŸèƒ½å°±æ˜¯é¿å…ç”¨æˆ·è¿›è¡Œä¸Šè¿°çš„ç¹ççš„è®¾ç½®æ“ä½œï¼Œåœ¨ç•Œé¢é€šè¿‡åŠŸèƒ½æŒ‰é’®ä¸€é”®åˆ‡æ¢å³å¯ã€‚</p><h4 id="è®¾ç½®ç³»ç»Ÿ-proxy">è®¾ç½®ç³»ç»Ÿ proxy</h4><p>å®¢æˆ·ç«¯é€‚é…äº†Ubuntu æ“ä½œç³»ç»Ÿä¸­æœ€å¸¸ç”¨çš„ <code>Gnome</code> æ¡Œé¢ç‰ˆæœ¬ï¼ŒåŸç†æ˜¯ä½¿ç”¨å…¶è‡ªå¸¦çš„ <code>gsetting</code> å‘½ä»¤ç›´æ¥åœ¨å‘½ä»¤è¡Œè®¾ç½® proxyï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setGlobalProxy</span> = <span class="keyword">async</span> (<span class="params">host: <span class="built_in">string</span>, port: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// å¼€å¯æ‰‹åŠ¨æ¨¡å¼</span></span><br><span class="line">  <span class="keyword">const</span> manualSet = <span class="keyword">await</span> <span class="title function_">execAsync</span>(</span><br><span class="line">    <span class="string">&quot;gsettings set org.gnome.system.proxy mode manual&quot;</span></span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// è®¾ç½®ä¸»æœºå</span></span><br><span class="line">  <span class="keyword">const</span> hostSet = <span class="keyword">await</span> <span class="title function_">execAsync</span>(</span><br><span class="line">    <span class="string">`gsettings set org.gnome.system.proxy.socks host &#x27;<span class="subst">$&#123;host&#125;</span>&#x27;`</span></span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// è®¾ç½®ç«¯å£å·</span></span><br><span class="line">  <span class="keyword">const</span> portSet = <span class="keyword">await</span> <span class="title function_">execAsync</span>(</span><br><span class="line">    <span class="string">`gsettings set org.gnome.system.proxy.socks port <span class="subst">$&#123;port&#125;</span>`</span></span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// è®¾ç½®å¿½ç•¥çš„æœ¬åœ°åœ°å€</span></span><br><span class="line">  <span class="keyword">const</span> bypassSet = <span class="keyword">await</span> <span class="title function_">execAsync</span>(</span><br><span class="line">    <span class="string">`gsettings set org.gnome.system.proxy ignore-hosts &quot;[&#x27;<span class="subst">$&#123;ignoredHosts&#125;</span>&#x27;]&quot;`</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    manualSet.<span class="property">code</span> === <span class="number">0</span> &amp;&amp;</span><br><span class="line">    hostSet.<span class="property">code</span> === <span class="number">0</span> &amp;&amp;</span><br><span class="line">    portSet.<span class="property">code</span> === <span class="number">0</span> &amp;&amp;</span><br><span class="line">    bypassSet.<span class="property">code</span> === <span class="number">0</span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è€Œå¯¹äº Mac æ“ä½œç³»ç»Ÿä¹Ÿæœ‰ç±»ä¼¼çš„æ“ä½œå‘½ä»¤ <code>networksetup</code>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setGlobalProxy</span> = <span class="keyword">async</span> (<span class="params">host: <span class="built_in">string</span>, port: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> services = <span class="keyword">await</span> <span class="title function_">listNetworkServices</span>();</span><br><span class="line">  <span class="keyword">if</span> (!services) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> results = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(</span><br><span class="line">    services.<span class="title function_">map</span>(<span class="keyword">async</span> service =&gt; &#123;</span><br><span class="line">      <span class="comment">// å¼€å¯æ¨¡å¼</span></span><br><span class="line">      <span class="keyword">const</span> autoSet = <span class="keyword">await</span> <span class="title function_">execAsync</span>(</span><br><span class="line">        <span class="string">`networksetup -setsocksfirewallproxystate &#x27;<span class="subst">$&#123;service&#125;</span>&#x27; on`</span></span><br><span class="line">      );</span><br><span class="line">      <span class="comment">// è®¾ç½®ä¸»æœºåå’Œç«¯å£å·</span></span><br><span class="line">      <span class="keyword">const</span> urlSet = <span class="keyword">await</span> <span class="title function_">execAsync</span>(</span><br><span class="line">        <span class="string">`networksetup -setsocksfirewallproxy &#x27;<span class="subst">$&#123;service&#125;</span>&#x27; &#x27;<span class="subst">$&#123;host&#125;</span>&#x27; <span class="subst">$&#123;port&#125;</span>`</span></span><br><span class="line">      );</span><br><span class="line">      <span class="comment">// è®¾ç½®å¿½ç•¥çš„æœ¬åœ°åœ°å€</span></span><br><span class="line">      <span class="keyword">const</span> bypassSet = <span class="keyword">await</span> <span class="title function_">execAsync</span>(</span><br><span class="line">        <span class="string">`networksetup -setproxybypassdomains &#x27;<span class="subst">$&#123;service&#125;</span>&#x27; &#x27;<span class="subst">$&#123;ignoredHosts&#125;</span>&#x27;`</span></span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">return</span> autoSet.<span class="property">code</span> === <span class="number">0</span> &amp;&amp; urlSet.<span class="property">code</span> === <span class="number">0</span> &amp;&amp; bypassSet.<span class="property">code</span> === <span class="number">0</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> results.<span class="title function_">filter</span>(<span class="function"><span class="params">i</span> =&gt;</span> i === <span class="literal">true</span>).<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®ç³»ç»Ÿ-pac-æ–‡ä»¶åœ°å€">è®¾ç½®ç³»ç»Ÿ pac æ–‡ä»¶åœ°å€</h4><p>åŸç†éƒ½ç›¸åŒï¼Œéƒ½æ˜¯ä½¿ç”¨å‘½ä»¤ç”Ÿæˆ <code>pac</code> æ–‡ä»¶ï¼Œç„¶åå¯åŠ¨ä¸€ä¸ª <code>http</code> æœåŠ¡å™¨åšé™æ€æ‰˜ç®¡ï¼Œæœ€åé€šè¿‡æ“ä½œç³»ç»Ÿå†…ç½®å‘½ä»¤å°† pac æ–‡ä»¶åœ°å€è®¾ç½®å¥½å³å¯ã€‚</p><p>åœ¨ Ubuntu ç³»ç»Ÿä¸­ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setPacProxy</span> = <span class="keyword">async</span> (<span class="params">url: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// å¯åŠ¨ pac æ¨¡å¼</span></span><br><span class="line">  <span class="keyword">const</span> autoSet = <span class="keyword">await</span> <span class="title function_">execAsync</span>(</span><br><span class="line">    <span class="string">&quot;gsettings set org.gnome.system.proxy mode auto&quot;</span></span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// è®¾ç½® pac åœ°å€</span></span><br><span class="line">  <span class="keyword">const</span> urlSet = <span class="keyword">await</span> <span class="title function_">execAsync</span>(</span><br><span class="line">    <span class="string">`gsettings set org.gnome.system.proxy autoconfig-url &#x27;<span class="subst">$&#123;url&#125;</span>&#x27;`</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> autoSet.<span class="property">code</span> === <span class="number">0</span> &amp;&amp; urlSet.<span class="property">code</span> === <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨ Mac ç³»ç»Ÿä¸­ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">listNetworkServices</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">execAsync</span>(<span class="string">&quot;networksetup -listallnetworkservices&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (result.<span class="property">code</span> === <span class="number">0</span> &amp;&amp; result.<span class="property">stdout</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> r = result.<span class="property">stdout</span>.<span class="title function_">split</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    r.<span class="title function_">shift</span>();</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setPacProxy</span> = <span class="keyword">async</span> (<span class="params">url: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// è·å–æ‰€æœ‰ç½‘ç»œæœåŠ¡</span></span><br><span class="line">  <span class="keyword">const</span> services = <span class="keyword">await</span> <span class="title function_">listNetworkServices</span>();</span><br><span class="line">  <span class="keyword">if</span> (!services) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> results = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(</span><br><span class="line">    services.<span class="title function_">map</span>(<span class="keyword">async</span> service =&gt; &#123;</span><br><span class="line">      <span class="comment">// å¯åŠ¨ pac æ¨¡å¼</span></span><br><span class="line">      <span class="keyword">const</span> autoSet = <span class="keyword">await</span> <span class="title function_">execAsync</span>(</span><br><span class="line">        <span class="string">`networksetup -setautoproxystate &#x27;<span class="subst">$&#123;service&#125;</span>&#x27; on`</span></span><br><span class="line">      );</span><br><span class="line">      <span class="comment">// è®¾ç½® pac åœ°å€</span></span><br><span class="line">      <span class="keyword">const</span> urlSet = <span class="keyword">await</span> <span class="title function_">execAsync</span>(</span><br><span class="line">        <span class="string">`networksetup -setautoproxyurl &#x27;<span class="subst">$&#123;service&#125;</span>&#x27; &#x27;<span class="subst">$&#123;url&#125;</span>&#x27;`</span></span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">return</span> autoSet.<span class="property">code</span> === <span class="number">0</span> &amp;&amp; urlSet.<span class="property">code</span> === <span class="number">0</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> results.<span class="title function_">filter</span>(<span class="function"><span class="params">i</span> =&gt;</span> i === <span class="literal">true</span>).<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="7-å¤šå¹³å°åŠŸèƒ½é€‚é…ä¹‹åº”ç”¨å¼€æœºè‡ªå¯åŠ¨">7. å¤šå¹³å°åŠŸèƒ½é€‚é…ä¹‹åº”ç”¨å¼€æœºè‡ªå¯åŠ¨</h3><p>åŸä½œè€…ä»…æ”¯æŒäº† Mac ç³»ç»Ÿçš„å¼€æœºè‡ªå¯ï¼Œä½¿ç”¨äº† Electron è‡ªå¸¦çš„å¹³å°ä¸“ç”¨ API - <code>setLoginItemSettings</code>ï¼Œä¸è¿‡ API ä»…æ”¯æŒ Macï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; app &#125; <span class="keyword">from</span> <span class="string">&#x27;electron&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// è®¾ç½®ç™»å½•çŠ¶æ€ï¼Œé»˜è®¤æ˜¯ä¸º process.execPath è®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line">app.<span class="title function_">setLoginItemSettings</span>(&#123;</span><br><span class="line">    <span class="attr">openAtLogin</span>: params.<span class="property">openAtLogin</span>, <span class="comment">// å¼€æœºè‡ªå¯</span></span><br><span class="line">    <span class="attr">openAsHidden</span>: params.<span class="property">openAsHidden</span> <span class="comment">// è‡ªåŠ¨éšè—çª—å£</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Ubuntu æˆ‘è¿˜æ˜¯ç”¨çš„æ¯”è¾ƒç†Ÿæ‚‰çš„ï¼Œæ¯•ä¸šåä¸€ç›´ç”¨äºå·¥ä½œå’Œæ—¥å¸¸ä½¿ç”¨ã€‚åŠ ä¸Šä¹‹å‰ä¹Ÿåšè¿‡ä¸€ä¸ª Ubuntu ç‰ˆæœ¬çš„ç±»ä¼¼ç”µè„‘ç®¡å®¶çš„<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/nojsja/electronux">å°æ¡Œé¢åº”ç”¨</a>ï¼Œå› æ­¤å¯¹ Gnome æ¡Œé¢å’Œ Electron æ–¹é¢çš„äº¤äº’æœ‰ä¸€å®šç»éªŒã€‚Ubuntu ä¸Šé¢è¦æƒ³å®ç°åº”ç”¨å¼€æœºè‡ªå¯éœ€è¦è‡ªå·±å®šåˆ¶ä¸€ä¸ªé…ç½®æ–‡ä»¶åˆ° <code>~/.config/autostart/</code> è·¯å¾„ä¸‹ï¼Œæ¯”å¦‚ <code>~/.config/autostart/shasowsocks-electron.desktop</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/autostart.png" alt="autostart"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Desktop Entry]</span><br><span class="line">Name=Shadowsocks Electron</span><br><span class="line">Exec=shadowsocks-electron</span><br><span class="line">Terminal=false</span><br><span class="line">Type=Application</span><br><span class="line">Icon=shadowsocks-electron</span><br><span class="line">StartupWMClass=Shadowsocks Electron</span><br><span class="line">Encoding=UTF-8</span><br><span class="line">Comment=Shadowsocks GUI with cross-platform desktop support</span><br><span class="line">Categories=Network</span><br><span class="line">Hidden=false</span><br></pre></td></tr></table></figure><p>éœ€è¦é‡ç‚¹å…³æ³¨çš„æ˜¯ä»¥ä¸‹å­—æ®µï¼š</p><ul><li>Execï¼šåº”ç”¨å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„æˆ–å‘½ä»¤</li><li>Typeï¼šGUIåº”ç”¨åº”å¡«å†™ Application</li><li>Hiddenï¼šç¦ç”¨/å¯ç”¨çŠ¶æ€</li></ul><p>åœ¨å®¢æˆ·ç«¯ä¸­å½“ç”¨æˆ·å¼€å¯äº†å¼€æœºè‡ªå¯åŠŸèƒ½æ—¶ï¼ŒNode.js å°±æ£€æŸ¥ç›¸åº”ç›®å½•æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ–‡ä»¶ï¼Œä¸å­˜åœ¨çš„è¯å…ˆä½¿ç”¨ <code>fs.write</code> API åˆ›å»ºæ–‡ä»¶ï¼Œå¹¶æ ¹æ®å…·ä½“çš„å¼€å¯/ç¦ç”¨çŠ¶æ€æ›´æ”¹ <strong>Hidden</strong> å­—æ®µå³å¯ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setStartupOnBoot_linux</span> = (<span class="params">on: <span class="built_in">boolean</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> startupDir = <span class="string">`<span class="subst">$&#123;os.homedir()&#125;</span>/.config/autostart`</span>;</span><br><span class="line">  <span class="keyword">const</span> startupFile = <span class="string">&#x27;shadowsocks-electron.desktop&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> fileContent = [</span><br><span class="line">    <span class="string">&quot;[Desktop Entry]&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Name=Shadowsocks Electron&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Exec=shadowsocks-electron&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Terminal=false&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Type=Application&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Icon=shadowsocks-electron&quot;</span>,</span><br><span class="line">    <span class="string">&quot;StartupWMClass=Shadowsocks Electron&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Encoding=UTF-8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Comment=Shadowsocks GUI with cross-platform desktop support&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Categories=Network&quot;</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.<span class="title function_">writeFile</span>(</span><br><span class="line">      path.<span class="title function_">join</span>(startupDir, startupFile),</span><br><span class="line">      <span class="comment">// æ–°å¢ä¸€è¡Œ Hidden å­—æ®µæè¿°</span></span><br><span class="line">      <span class="string">`<span class="subst">$&#123;fileContent.join(os.EOL)&#125;</span><span class="subst">$&#123;os.EOL&#125;</span>Hidden=<span class="subst">$&#123;on ? <span class="literal">false</span> : <span class="literal">true</span>&#125;</span>`</span>,</span><br><span class="line">      (<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="title function_">reject</span>(err);</span><br><span class="line">        <span class="title function_">resolve</span>(path.<span class="title function_">join</span>(startupDir, startupFile));</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-ä½¿ç”¨-Electron-è¿›ç¨‹ç®¡ç†å™¨æé«˜å¼€å‘è°ƒè¯•æ•ˆç‡">8. ä½¿ç”¨ Electron è¿›ç¨‹ç®¡ç†å™¨æé«˜å¼€å‘è°ƒè¯•æ•ˆç‡</h3><p>ä¸Šæ–‡åœ¨æè¿° <code>redux-persist</code> æ•°æ®æŒä¹…åŒ–åŠŸèƒ½æ—¶æåˆ°è¿‡ï¼ŒElectron æ¡†æ¶æœ€è¿‘çš„å‡ ä¸ªç‰ˆæœ¬å¸¦æ¥äº†ä¸€ä¸ªç ´åæ€§ä¿®æ”¹ï¼Œ<code>remote</code> è¿œç¨‹è°ƒç”¨è¢«å¼ºåˆ¶ç§»é™¤äº†ã€‚è¿™æ ·å­ npm ä¸Šå¤§é‡çš„ä¾èµ– remote API çš„å¼€æºå·¥å…·å°±ä¼šå‡ºç°å…¼å®¹æ€§é—®é¢˜ï¼Œé™¤éå¼€æºä½œè€…å°† <code>electron.remote</code> æ›´æ”¹ä¸º <code>@electron/remote</code> ç¬¬ä¸‰æ–¹å¤–éƒ¨åŒ…ã€‚</p><p>ä¸è¿‡æ€»æœ‰ä¸€äº›å¼€æºä»“åº“ä¸ä¼šè¢«å¼€æºä½œè€…å’Œç¤¾åŒºä¸€ç›´ç»´æŠ¤ï¼Œæˆ‘ä¹‹å‰åœ¨å¼€å‘é˜¶æ®µä¸€ç›´ç”¨çš„è°ƒè¯•å·¥å…· <code>devtron</code> å°±æ˜¯è¿™ä¸ªæƒ…å†µã€‚å·¥å…·å¯ä»¥åœ¨ <code>devtools</code> æ§åˆ¶å°ä¸­å¼€å¯ä¸€ä¸ªé¢æ¿æŸ¥çœ‹ electron çš„ <code>ipc</code> é€šä¿¡è®°å½•ï¼Œå› ä¸º Electron æœ¬åœ°åº”ç”¨ä¸å­˜åœ¨ http è¯·æ±‚ï¼Œå› æ­¤ä¸ä¼šåœ¨ç½‘ç»œè¯·æ±‚é¢æ¿ä¸­çœ‹åˆ°ï¼Œæ‰€ä»¥éœ€è¦è¿™æ ·ä¸€ä¸ªå·¥å…·æŸ¥çœ‹ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¹‹é—´çš„æ¶ˆæ¯è®°å½•ä»¥ä¾¿è¿½è¸ªåº”ç”¨ã€‚</p><p><code>devtron</code> github ä¸»é¡µè´´ç€é¡¹ç›®ä¸å†ç»´æŠ¤ï¼Œå¯»æ±‚çƒ­å¿ƒçš„å¼€æºå¼€å‘è€…ç»§ç»­ç»´æŠ¤çš„æ¶ˆæ¯ã€‚<code>devtron</code> æœ€è¿‘çš„ä¸€æ¬¡ç‰ˆæœ¬åœ¨æˆ‘ä½¿ç”¨çš„ <code>electron@13.4.0</code> ä¸Šä¹Ÿç›´æ¥æ­‡èœäº†ğŸ¤ªã€‚æˆ‘é‡åˆ° <code>devtron</code> æŠ¥é”™æ‰“ä¸å¼€çš„æƒ…å†µåç´¢æ€§çªå‘å¥‡æƒ³å°†æ‰€æœ‰åŸç”Ÿçš„ <code>ipc</code> é€šä¿¡æ–¹å¼(on / once / send / sendTo / invoke / handleâ€¦) ä½¿ç”¨æˆ‘è‡ªå·±ä¹‹å‰å¼€å‘çš„è¿›ç¨‹ç®¡ç†å·¥å…· <code>electron-re</code> æ›¿ä»£ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/nojsja/electron-re">github ä»“åº“</a>ã€‚è¿ç§»åˆ° <code>electron-re</code> ä¹‹åï¼Œæˆ‘åœ¨é¡¹ç›®ä¸­å¼€äº†ä¸€ä¸ª <code>dev</code> åˆ†æ”¯ä¸“é—¨ç”¨äºæ”¯æŒ<code>ipc</code> é€šä¿¡è®°å½•åŠŸèƒ½ï¼Œå…¶å®é€‚é…å·¥ä½œé‡ä¸å¤§ï¼Œå†™ä¸ªUIç•Œé¢ï¼Œç„¶ååœ¨åŸæœ‰çš„æ•°æ®é‡‡é›†æ¨¡å—æ–°å¢ä¸€ç‚¹é€»è¾‘å³å¯ã€‚</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/process_manager.png" alt="process_manager"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/ipc.png" alt="ipc"></p><p>è¿™é‡Œé¡ºä¾¿æ‰“ä¸ªå¹¿å‘ŠğŸ¤ï¼Œ<code>electron-re</code> ä¸»è¦æ˜¯ä½œä¸ºä¸€ä¸ªè¿›ç¨‹ç®¡ç†å™¨å’Œ <code>ipc</code> é€šä¿¡å·¥å…·å¼€å‘çš„ï¼Œé™¤äº†æ”¯æŒ Electron åº”ç”¨ä¸­ä¸»è¿›ç¨‹ã€æ¸²æŸ“è¿›ç¨‹ã€service è¿›ç¨‹(<code>electron-re</code> å¼•å…¥)ã€child è¿›ç¨‹(<code>electron-re</code> å¼•å…¥) çš„èµ„æºå ç”¨æƒ…å†µåŠ¨æ€ç»Ÿè®¡åŠŸèƒ½ï¼Œä¹Ÿæä¾›äº†ä¸€ä¸ª ipc é€šä¿¡å·¥å…· <code>MessageChannel</code>ï¼Œå®ƒåŸºäº electron åŸç”Ÿ ipc é€šä¿¡å¼€å‘ã€‚é™¤æ­¤ä¹‹å¤–å®ƒè¿˜æä¾›äº†ä¸€ä¸ªç®€å•å®ç°çš„è¿›ç¨‹æ± å·¥å…· <code>ChildProcessPool</code> å’Œä¸ä¹‹é…å¥—ä½¿ç”¨çš„ <code>ProcessHost</code> æ¶ˆæ¯å·¥å…·ã€‚è¿™æ¬¡é’ˆå¯¹ <code>shadowsocks-electron</code> å’Œå…¶ä»– Electron åº”ç”¨å¼€å‘çš„ ipc é€šä¿¡è®°å½•é¢æ¿åŠŸèƒ½å°±æ˜¯åœ¨ <code>MessageChannel</code> é€šä¿¡å·¥å…·ä¸­é€šè¿‡æ–°å¢é€šä¿¡è®°å½•ä¸ŠæŠ¥é€»è¾‘æ¥å®ç°çš„ã€‚</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/electron-re.png" alt="process_manager"></p><h2 id="Others">Others</h2><blockquote><p>å¼€å‘è¿‡ç¨‹ä¸­çš„å…¶å®ƒæåŠ</p></blockquote><h3 id="1-Mac-è™šæ‹ŸæœºçœŸæ˜¯éš¾è£…">1. Mac è™šæ‹ŸæœºçœŸæ˜¯éš¾è£…</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/virtualbox_detail.png" alt="virtualbox_detail"></p><p>å®‰è£… Mac è™šæ‹Ÿæœºè¶³è¶³æŠ˜ç£¨äº†æˆ‘ä¸€å¤©å¤šï¼Œå®ä½“æœºå®‰è£… Ubuntu åŒç³»ç»Ÿ 40 åˆ†é’Ÿå°±èƒ½è§£å†³çš„äº‹å„¿ï¼Œä»ä¸‹è½½ virtualbox å¯ç”¨çš„ <code>MacOS 10.15</code> å¼€å§‹ï¼Œé¾Ÿé€Ÿç™¾åº¦ç½‘ç›˜ã€‚å®‰è£… ISO æ—¶å¾ˆå®¹æ˜“å¡ä½æˆ–è€…æŠ¥é”™ï¼Œæœ€åæŸ¥äº†å¾ˆå¤šèµ„æ–™æ•´ç†å‡ºä»¥ä¸‹æ­¥éª¤ï¼š</p><p>ä¸€å°æ”¯æŒè‹±ç‰¹å°”è™šæ‹ŸåŒ–æŠ€æœ¯çš„ç”µè„‘ + <a target="_blank" rel="noopener external nofollow noreferrer" href="https://pan.baidu.com/s/1OeMhhKdXSbiqIPGluq3CAA">MacOS 10.15 é•œåƒ</a> (å¯†ç ï¼š3guu)</p><ul><li>1ï¼‰VirtualBoxè™šæ‹Ÿæœºè½¯ä»¶ï¼Œç‰ˆæœ¬å·åœ¨ 6.0 åŠä»¥ä¸Šå³å¯ã€‚</li><li>2ï¼‰å¯åŠ¨è™šæ‹Ÿæœºåˆ›å»ºå‘å¯¼ï¼Œé€‰æ‹©ç±»å‹ - <code>Mac OS X</code>ï¼Œç‰ˆæœ¬ -<code>Mac OS x64</code>ã€‚</li><li>3ï¼‰å…¶ä½™ä»€ä¹ˆå†…å­˜ã€ç£ç›˜ä¹‹ç±»çš„æŒ‰ç…§è‡ªå·±éœ€æ±‚å¤§æ¦‚é…ç½®ä¸€ä¸‹ï¼Œæ ¼å¤–æ³¨æ„çš„æ˜¯ç½‘ç»œä¸è¦é€‰æ‹©<code>æ¡¥æ¥ç½‘å¡</code>ï¼Œé€‰ä¸­é»˜è®¤çš„<code>NAT</code>ç½‘ç»œæ¨¡å¼ï¼Œå¦åˆ™ Ubuntu20.04 æ“ä½œç³»ç»Ÿä¸‹å¯èƒ½ä¼šåœ¨è¿è¡Œè™šæ‹Ÿæœºçš„æ—¶å€™å¡æ­»å®¿ä¸»æœºã€‚<code>NAT</code> æ¨¡å¼ä¸èƒ½åˆ†é…å’Œå®¿ä¸»æœºåŒç½‘æ®µçš„ç‹¬ç«‹ IPï¼Œå› æ­¤å¦‚æœè¦é€šè¿‡ SSH è®¿é—®è™šæ‹Ÿæœºçš„è¯å¯ä»¥åœ¨è™šæ‹Ÿæœºè®¾ç½®é‡Œé¢å¼€å¯ç«¯å£è½¬å‘ï¼Œæ¯”å¦‚æˆ‘å°†å®¿ä¸»æœºç«¯å£ <code>2222</code> æ˜ å°„åˆ°è™šæ‹Ÿæœºå†…éƒ¨ ssh çš„é»˜è®¤ç«¯å£ <code>22</code>ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å®¿ä¸»æœºé€šè¿‡å‘½ä»¤ï¼š<code>ssh -p 2222 nojsja@127.0.0.1</code> æ¥è¿æ¥äº†ã€‚</li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/virtualbox_nat.png" alt="virtualbox_nat"></p><ul><li>4ï¼‰è™šæ‹Ÿæœºåˆ›å»ºå¥½åæ³¨æ„åœ¨è™šæ‹Ÿæœºè®¾ç½®ä¸­<code>å­˜å‚¨</code>é¡µé¢æ·»åŠ ä¸‹è½½å¥½çš„ ISO å…‰ç›˜é•œåƒä½œä¸ºå¼€æœºå¼•å¯¼ã€‚</li><li>5ï¼‰ä»¥ä¸Šæ­¥éª¤å‡†å¤‡å¥½åï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„æ“ä½œï¼Œè®¾ç½®è™šæ‹Ÿæœºç›¸å…³é…ç½®ï¼Œä¸ç„¶å®‰è£…å¾ˆå¯èƒ½å‡ºé”™ï¼š</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤è¡Œç»ˆç«¯ä¸­ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œ&quot;macOS&quot; æ›¿æ¢ä¸ºè‡ªå·±è™šæ‹Ÿæœºçš„åå­—</span></span><br><span class="line">$: VBoxManage modifyvm <span class="string">&quot;macOS&quot;</span> --cpuidset 00000001 000106e5 00100800 0098e3fd bfebfbff </span><br><span class="line">$: VBoxManage setextradata <span class="string">&quot;macOS&quot;</span> <span class="string">&quot;VBoxInternal/Devices/efi/0/Config/DmiSystemProduct&quot;</span> <span class="string">&quot;iMac11,3&quot;</span> </span><br><span class="line">$: VBoxManage setextradata <span class="string">&quot;macOS&quot;</span> <span class="string">&quot;VBoxInternal/Devices/efi/0/Config/DmiSystemVersion&quot;</span> <span class="string">&quot;1.0&quot;</span> </span><br><span class="line">$: VBoxManage setextradata <span class="string">&quot;macOS&quot;</span> <span class="string">&quot;VBoxInternal/Devices/efi/0/Config/DmiBoardProduct&quot;</span> <span class="string">&quot;Iloveapple&quot;</span> </span><br><span class="line">$: VBoxManage setextradata <span class="string">&quot;macOS&quot;</span> <span class="string">&quot;VBoxInternal/Devices/smc/0/Config/DeviceKey&quot;</span> <span class="string">&quot;ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc&quot;</span> </span><br><span class="line">$: VBoxManage setextradata <span class="string">&quot;macOS&quot;</span> <span class="string">&quot;VBoxInternal/Devices/smc/0/Config/GetKeyFromRealSMC&quot;</span> 1</span><br><span class="line">$: VBoxManage modifyvm <span class="string">&quot;macOS&quot;</span> --cpu-profile <span class="string">&quot;Intel Core i7-6700K&quot;</span></span><br></pre></td></tr></table></figure><ul><li>6ï¼‰ä¹‹åå°±æ¯”è¾ƒå¸¸è§„äº†ï¼Œå¼€å¯è™šæ‹Ÿæœºåï¼Œåœ¨â€œmacOS Utilitiesâ€çª—å£çš„åˆ—è¡¨ä¸­ï¼ŒåŒå‡»â€œDisk Utilityâ€é¡¹ï¼Œæ¥å¯åŠ¨ç£ç›˜åŠ©ç†ï¼Œå¯¹ç£ç›˜è¿›è¡Œåˆ†åŒºã€‚å°†éœ€è¦ä½¿ç”¨çš„è™šæ‹Ÿå®‰è£…ç¡¬ç›˜æ ¼å¼åŒ–ä¸º â€œMac OS Extended(Journaled)â€æˆ–â€œAPFSâ€å³å¯ã€‚</li><li>7ï¼‰å…¶ä½™æµç¨‹è·Ÿç€å¼•å¯¼èµ°å³å¯ï¼Œæœ€åå®‰è£…å®Œäº†é‡å¯ä¹‹åï¼Œåˆ«å¿˜äº†åœ¨è™šæ‹Ÿæœº<code>å­˜å‚¨</code>é‡Œå¸è½½ ISO å¼•å¯¼å…‰ç›˜ï¼Œå¦åˆ™ä¼šå¼€æœºä¸€ç›´è¿›å…¥å®‰è£…ç•Œé¢ã€‚</li></ul><h3 id="2-Mac-brew-åœ¨å›½å†…ç¯å¢ƒçš„å®‰è£…æ–¹å¼">2. Mac brew åœ¨å›½å†…ç¯å¢ƒçš„å®‰è£…æ–¹å¼</h3><p>Mac å®‰è£…å¥½åï¼Œéœ€è¦ä½¿ç”¨ <code>brew</code> åŒ…ç®¡ç†å™¨å®‰è£… <code>shadowsocks-libev</code>ï¼Œå®˜æ–¹æä¾›çš„è„šæœ¬åœ¨å›½å†…ç½‘ç»œç¯å¢ƒä¸‹ä¼šå®‰è£…å¤±è´¥ï¼Œå»ºè®®ä½¿ç”¨å›½å†…å¼€å‘è€…ç¼–å†™çš„ç‰ˆæœ¬ï¼š</p><ol><li><p>å®˜æ–¹è„šæœ¬ï¼š<code>/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot;</code></p></li><li><p>å›½å†…å¼€å‘è€…ç¼–å†™çš„è„šæœ¬ï¼š<code>/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot;</code></p></li></ol><h3 id="3-Node-js-child-process-æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸€äº›å‘">3. Node.js child_process æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸€äº›å‘</h3><p>å®¢æˆ·ç«¯ä¸­ MacOS å¹³å°éœ€è¦æ‰§è¡Œ <code>shadowsocks-libev</code> åº“ä¸­æä¾›çš„å‘½ä»¤è¿æ¥æœåŠ¡å™¨å¦‚ï¼š<code>sslocal -s host -p port -l localPort -k password -m method ...</code>ï¼Œä¸Šæ–‡ä¸­æåˆ°é’ˆå¯¹ MacOS çš„å…¼å®¹æ–¹å¼æ˜¯åœ¨æ„å»ºåŒ…ä¸­æä¾› <code>ss-local</code> äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»¥é¿å…è®©ç”¨æˆ·æ‰‹åŠ¨æ‰§è¡Œ <code>brew install shadowsocks-libev</code> æ¥å®‰è£…ä¾èµ–åº“ã€‚</p><p>è¿™é‡Œæœ‰ä¸ªå‘å°±æ˜¯å¼€å‘è€…ä¸ºç”¨æˆ·æä¾› <code>ss-local</code> åï¼Œé»˜è®¤è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯æ”¾åœ¨åº”ç”¨å®‰è£…ç›®å½•çš„ï¼Œä½†æ˜¯ä½ ä¸çŸ¥é“ç”¨æˆ·æ“ä½œç³»ç»Ÿä¸­ä½ çš„å®¢æˆ·ç«¯è½¯ä»¶ä¼šè¢«å…·ä½“å®‰è£…åˆ°å“ªé‡Œï¼Œæå¯èƒ½æ˜¯ç³»ç»Ÿç›¸å…³ç›®å½•ã€‚ç³»ç»Ÿç›¸å…³ç›®å½•ä¸­çš„æ–‡ä»¶ Electron é»˜è®¤æ˜¯ä¸èƒ½æ‰§è¡Œçš„ï¼Œä¹Ÿä¸èƒ½é€šè¿‡ Node.js æä¾›çš„ <code>fs.chmod</code> æ–¹å¼æ‰‹åŠ¨ä¸ºå¯æ‰§è¡Œæ–‡ä»¶æˆäºˆæ‰§è¡Œæƒé™ã€‚</p><p>è¿™ä¸ªé—®é¢˜ä¹‹å‰å¼€å‘ Ubuntu æ¡Œé¢ç®¡å®¶çš„æ—¶å€™é‡åˆ°è¿‡ï¼Œéƒ½æ˜¯ Unix ç³»çš„æ“ä½œç³»ç»Ÿï¼ŒMac è¿™è¾¹ä¹Ÿä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯å°†å®¢æˆ·ç«¯éœ€è¦ç”¨åˆ°çš„ bin äºŒè¿›åˆ¶æ–‡ä»¶åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™æ‹·è´åˆ°ç”¨æˆ·æ•°æ®ç›®å½•ï¼Œè¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ç”¨æˆ·æ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒï¼Œå¯ä»¥ä½¿ç”¨ Node.js æä¾›çš„ <code>fs.chmod</code> APIè®©äºŒè¿›åˆ¶æ–‡ä»¶å¯æ‰§è¡Œã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ------ utils.ts ------ */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * checkEnvFiles [æ£€æŸ¥ç¯å¢ƒæ–‡ä»¶æ˜¯å¦å­˜åœ¨]</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@author</span> <span class="variable">nojsja</span></span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125; param [desc]</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">export</span> <span class="keyword">const</span> checkEnvFiles = (<span class="attr">args</span>: &#123;<span class="attr">_path</span>: <span class="built_in">string</span>, <span class="attr">isDir</span>: <span class="built_in">boolean</span>, exec?: <span class="function">() =&gt;</span> <span class="built_in">void</span>&#125;[]): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> check = <span class="keyword">function</span> (<span class="params">params: &#123;_path: <span class="built_in">string</span>, isDir: <span class="built_in">boolean</span>, exec?: () =&gt; <span class="built_in">void</span>&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(params.<span class="property">_path</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (params.<span class="property">isDir</span>) &#123;</span><br><span class="line">        fs.<span class="title function_">mkdirSync</span>(params.<span class="property">_path</span>);</span><br><span class="line">        params.<span class="property">exec</span> &amp;&amp; params.<span class="title function_">exec</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fs.<span class="title function_">closeSync</span>(fs.<span class="title function_">openSync</span>(params.<span class="property">_path</span>, <span class="string">&#x27;w&#x27;</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  args.<span class="title function_">forEach</span>(check);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * åŒæ­¥å¤åˆ¶ç›®å½•ã€å­ç›®å½•ï¼ŒåŠå…¶ä¸­çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> * @param src &#123;String&#125; è¦å¤åˆ¶çš„ç›®å½•</span></span><br><span class="line"><span class="comment"> * @param dist &#123;String&#125; å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">copyDir</span> = (<span class="params">src: <span class="built_in">string</span>, dist: <span class="built_in">string</span>, callback?: (params: <span class="built_in">any</span>) =&gt; <span class="built_in">void</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> paths, stat;</span><br><span class="line">  <span class="keyword">if</span>(!fs.<span class="title function_">existsSync</span>(dist)) &#123;</span><br><span class="line">    fs.<span class="title function_">mkdirSync</span>(dist);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_copy</span>(src, dist);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">_copy</span>(<span class="params">src: <span class="built_in">string</span>, dist: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    paths = fs.<span class="title function_">readdirSync</span>(src);</span><br><span class="line">    paths.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">_path</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> _src = path.<span class="title function_">join</span>(src, _path);</span><br><span class="line">        <span class="keyword">let</span> _dist = path.<span class="title function_">join</span>(dist, _path);</span><br><span class="line">        stat = fs.<span class="title function_">statSync</span>(_src);</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯æ–‡ä»¶è¿˜æ˜¯ç›®å½•</span></span><br><span class="line">        <span class="keyword">if</span>(stat.<span class="title function_">isFile</span>()) &#123;</span><br><span class="line">          fs.<span class="title function_">writeFileSync</span>(_dist, fs.<span class="title function_">readFileSync</span>(_src));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(stat.<span class="title function_">isDirectory</span>()) &#123;</span><br><span class="line">          <span class="comment">// å½“æ˜¯ç›®å½•æ˜¯ï¼Œé€’å½’å¤åˆ¶</span></span><br><span class="line">          <span class="title function_">copyDir</span>(_src, _dist, callback)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [fsChmod å¯¹æ–‡ä»¶å’Œæ–‡ä»¶å¤¹é€’å½’æˆäºˆæƒé™]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[String]</span>&#125; dir   [æ–‡ä»¶å¤¹]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[int]</span>&#125; opstr [å…«è¿›åˆ¶æ•°å­—ï¼Œä¾‹å¦‚0o711]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">chmod</span> = (<span class="params">target: <span class="built_in">string</span>, opstr: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (fs.<span class="title function_">statSync</span>(target).<span class="title function_">isDirectory</span>()) &#123;</span><br><span class="line">    <span class="keyword">const</span> files = fs.<span class="title function_">readdirSync</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (files.<span class="property">length</span>) &#123;</span><br><span class="line">      files.<span class="title function_">forEach</span>(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">        fs.<span class="title function_">chmod</span>(path.<span class="title function_">join</span>(target, file), opstr);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (target &amp;&amp; !target.<span class="title function_">includes</span>(<span class="string">&#x27;.gitignore&#x27;</span>)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`fs.chmod =&gt; <span class="subst">$&#123;target&#125;</span> with <span class="subst">$&#123;opstr&#125;</span>`</span>);</span><br><span class="line">      fs.<span class="title function_">chmodSync</span>(target, opstr);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* ------ ä¸»è¿›ç¨‹ index.ts ------ */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ·æ•°æ®ç›®å½•ä¸­çš„æ–‡ä»¶æ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒ</span></span><br><span class="line"><span class="keyword">const</span> appDataPath = path.<span class="title function_">join</span>(app.<span class="title function_">getPath</span>(<span class="string">&#x27;appData&#x27;</span>), packageName);</span><br><span class="line"><span class="keyword">const</span> pathRuntime = (<span class="variable language_">global</span> <span class="keyword">as</span> <span class="built_in">any</span>).<span class="property">pathRuntime</span> = path.<span class="title function_">join</span>(appDataPath, <span class="string">&#x27;runtime/&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§</span></span><br><span class="line"><span class="title function_">checkEnvFiles</span>(</span><br><span class="line">  [</span><br><span class="line">    &#123; <span class="attr">_path</span>: appDataPath, <span class="attr">isDir</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">_path</span>: pathRuntime, <span class="attr">isDir</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">_path</span>: path.<span class="title function_">join</span>(pathRuntime, <span class="string">&#x27;bin&#x27;</span>), <span class="attr">isDir</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">exec</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">copyDir</span>(path.<span class="title function_">join</span>(app.<span class="title function_">getAppPath</span>(), <span class="string">&#x27;bin&#x27;</span>), path.<span class="title function_">join</span>(pathRuntime, <span class="string">&#x27;bin&#x27;</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">);</span><br><span class="line"><span class="comment">// æˆæƒ</span></span><br><span class="line"><span class="title function_">chmod</span>(path.<span class="title function_">join</span>(pathRuntime, <span class="string">&#x27;bin&#x27;</span>), <span class="number">0o711</span>);</span><br></pre></td></tr></table></figure><h3 id="4-æ€æ ·ä¸ºæœªé€‚é…-Typescript-çš„ç¬¬ä¸‰æ–¹åŒ…ç¼–å†™-types-å£°æ˜">4. æ€æ ·ä¸ºæœªé€‚é… Typescript çš„ç¬¬ä¸‰æ–¹åŒ…ç¼–å†™ @types å£°æ˜</h3><p>ä¸Šæ–‡æåˆ°å¼•å…¥äº† <code>electron-re</code> è¿›ç¨‹ç®¡ç†å·¥å…·ç”¨äº ipc æ¶ˆæ¯è¿½è¸ªï¼Œä¸è¿‡ä¹‹å‰å¼€å‘ <code>electron-re</code> æ—¶å¹¶æœªé€‚é… Typescript ç¯å¢ƒï¼Œä»ç„¶æ˜¯ <code>commonJs</code> è§„èŒƒï¼Œä¸è¿‡ TS é‡Œå¼•å…¥ç¬¬ä¸‰æ–¹åŒ…åªè¦å­˜åœ¨ç±»å‹å£°æ˜æ–‡ä»¶å³å¯ã€‚æ–¹æ³•ä¸€æ˜¯ç¼–å†™ <code>@types/electron-re</code> å•ç‹¬å‘åŒ…æ”¯æŒï¼Œå¦ä¸€ç§å°±æ˜¯ç›´æ¥åœ¨ <code>electron-re</code> é¡¹ç›®ä¸‹å£°æ˜å³å¯ï¼Œè‡ªå·±çš„ä»“åº“å¯ä»¥é€‰æ‹©ç¬¬äºŒç§ã€‚</p><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»ºå£°æ˜æ–‡ä»¶ <code>types/index.d.ts</code>ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> electronReModule &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">interface</span> electronRe &#123;</span><br><span class="line">    <span class="title class_">MessageChannel</span>: &#123;</span><br><span class="line">      <span class="attr">invoke</span>: <span class="function">(<span class="params">name: <span class="built_in">string</span>, channel: <span class="built_in">string</span>, args: <span class="built_in">unknown</span></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;</span><br><span class="line">      <span class="attr">handle</span>: <span class="function">(<span class="params">channel: <span class="built_in">string</span>, promiseFunc: (event, args: &#123; action: <span class="built_in">string</span>, params: <span class="built_in">any</span> &#125;) =&gt; <span class="built_in">Promise</span>&lt;<span class="built_in">unknown</span>&gt;</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">send</span>: <span class="function">(<span class="params">name: <span class="built_in">string</span>, channel: <span class="built_in">string</span>, args: <span class="built_in">unknown</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">sendTo</span>: <span class="function">(<span class="params">id: <span class="built_in">number</span>, channel: <span class="built_in">string</span>, args: <span class="built_in">unknown</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">on</span>: <span class="function">(<span class="params">channel: <span class="built_in">string</span>, func: () =&gt; <span class="built_in">void</span></span>)  =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">once</span>: <span class="function">(<span class="params">channel: <span class="built_in">string</span>, func: () =&gt; <span class="built_in">void</span></span>)  =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">registry</span>: <span class="function">(<span class="params">name: <span class="built_in">string</span>, id: <span class="built_in">number</span>, pid: <span class="built_in">number</span></span>)  =&gt;</span> <span class="built_in">void</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title class_">BrowserService</span>: &#123;</span><br><span class="line">      <span class="attr">openDevTools</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">connected</span>: <span class="function">(<span class="params">callback?: () =&gt; <span class="built_in">void</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title class_">ChildProcessPool</span>: &#123;</span><br><span class="line">      <span class="attr">send</span>: <span class="function">(<span class="params">taskName: <span class="built_in">string</span>, params: <span class="built_in">unknown</span>, givenId: <span class="built_in">number</span></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;</span><br><span class="line">      <span class="attr">sendToAll</span>: <span class="function">(<span class="params">taskName: <span class="built_in">string</span>, params: <span class="built_in">unknown</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">kill</span>: <span class="function">(<span class="params">id?: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">setMaxInstanceLimit</span>: <span class="function">(<span class="params">count: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title class_">ProcessHost</span>: &#123;</span><br><span class="line">      <span class="attr">registry</span>: <span class="function">(<span class="params">taskName: <span class="built_in">string</span>, processor: () =&gt; <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt;</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">unregistry</span>: <span class="function">(<span class="params">taskName: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">disconnect</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">exit</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="title class_">ProcessManager</span>: &#123;</span><br><span class="line">      <span class="attr">pipe</span>: <span class="function">(<span class="params">pinstance: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">listen</span>: <span class="function">(<span class="params">pids: <span class="built_in">number</span>[], mark: <span class="built_in">string</span>, url?: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">unlisten</span>: <span class="function">(<span class="params">pids: <span class="built_in">number</span>[]</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">openDevTools</span>: <span class="function">(<span class="params">pid: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">killProcess</span>: <span class="function">(<span class="params">pid: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">setIntervalTime</span>: <span class="function">(<span class="params">time: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">      <span class="attr">openWindow</span>: <span class="function">(<span class="params">env: <span class="string">&#x27;prod&#x27;</span> | <span class="string">&#x27;dev&#x27;</span> | <span class="built_in">void</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">ere</span>: electronReModule.<span class="property">electronRe</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> = ere;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ <code>package.json</code> ä¸­å£°æ˜ç›¸å…³å­—æ®µå¼•å…¥ types æ–‡ä»¶ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./types/index.d.ts&quot;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<code>commonJs</code> è§„èŒƒå’Œ <code>ES module</code> è§„èŒƒçš„åŒ…å£°æ˜å†™æ³•ç•¥æœ‰ä¸åŒï¼Œè¿™é‡Œå†ç»™å‡ºä¸€ä¸ª <code>ES module</code> è§„èŒƒå£°æ˜æ–‡ä»¶ç¤ºä¾‹(ä¸ <code>electron-re</code> æ— å…³)ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ReturnTreeData</span> &#123;</span><br><span class="line">  <span class="attr">depth</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">boolean</span></span><br><span class="line">  <span class="attr">isInEdit</span>: <span class="built_in">boolean</span></span><br><span class="line">  <span class="attr">key</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">nameEditable</span>: <span class="built_in">boolean</span></span><br><span class="line">  <span class="attr">nodeDeletable</span>: <span class="built_in">boolean</span></span><br><span class="line">  <span class="attr">nodeName</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">nodeValue</span>: <span class="title class_">ReturnTreeData</span>[]</span><br><span class="line">  <span class="attr">valueEditable</span>: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TreeStateTypes</span> &#123;</span><br><span class="line">  <span class="attr">treeData</span>: <span class="title class_">ReturnTreeData</span>[];</span><br><span class="line">  <span class="attr">expandedKeys</span>: <span class="built_in">string</span>[];</span><br><span class="line">  <span class="attr">enableYaml</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">maxLevel</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">lang</span>: <span class="string">&#x27;zh_CN&#x27;</span> | <span class="string">&#x27;en_US&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TreePropsDataTypes</span> &#123;</span><br><span class="line">  <span class="attr">nodeName</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>; <span class="comment">// unique id, required</span></span><br><span class="line">  nameEditable ?: <span class="built_in">boolean</span>; <span class="comment">// is level editable (name), default true</span></span><br><span class="line">  valueEditable ?: <span class="built_in">boolean</span>; <span class="comment">// is level editable (value), default true</span></span><br><span class="line">  nodeDeletable ?: <span class="built_in">boolean</span>; <span class="comment">// is level deletable, default true</span></span><br><span class="line">  nodeValue : <span class="title class_">TreePropsDataTypes</span>[] | <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TreePropsTypes</span> &#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="title class_">TreePropsDataTypes</span>[];</span><br><span class="line">  <span class="attr">maxLevel</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">enableYaml</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">lang</span>: <span class="string">&#x27;en_US&#x27;</span> | <span class="string">&#x27;zh_CN&#x27;</span>;</span><br><span class="line">  <span class="attr">onDataChange</span>: <span class="function">(<span class="params">params: ReturnTreeData[]</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;editable-tree-antd&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">EditableTree</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&lt;<span class="title class_">TreePropsTypes</span>, <span class="title class_">TreeStateTypes</span>&gt; &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-æ„Ÿè°¢ä½œä¸º-UI-è®¾è®¡å¸ˆçš„-GF-å€¾æƒ…æ”¯æŒ">5. æ„Ÿè°¢ä½œä¸º UI è®¾è®¡å¸ˆçš„ GF å€¾æƒ…æ”¯æŒ</h3><p><code>shadowsocks-electron</code> å®¢æˆ·ç«¯çš„å›¾æ ‡æ˜¯ GF å·¥ä½œä¹‹ä½™å¸®å¿™å¤„ç†çš„ï¼Œå¥½çœ‹çš„æ¸å˜è‰²å°é£æœºå›¾æ ‡ï¼</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/logo.png" alt="logo"></p><h3 id="6-å»¶ä¼¸é˜…è¯»">6. å»¶ä¼¸é˜…è¯»</h3><ul><li><a target="_blank" rel="noopener" href="https://nojsja.gitee.io/blogs/2020/12/08/6d582478.html/">Electron / Node å¤šè¿›ç¨‹å·¥å…·å¼€å‘æ—¥è®° â¤ï¸ nojsja/blogs</a></li><li><a target="_blank" rel="noopener" href="https://nojsja.gitee.io/blogs/2020/12/18/927d467e.html/">Electron å¤šè¿›ç¨‹å·¥å…·å¼€å‘æ—¥è®°2ï¼šè¿›ç¨‹ç®¡ç†UI â¤ï¸ nojsja/blogs</a></li><li><a target="_blank" rel="noopener" href="https://nojsja.gitee.io/blogs/2020/08/16/1597e5d6.html/">åŸºäºElectron çš„ smb å®¢æˆ·ç«¯æ–‡ä»¶ä¸Šä¼ ä¼˜åŒ–æ¢ç´¢ â¤ï¸ nojsja/blogs</a></li><li><a target="_blank" rel="noopener" href="https://nojsja.gitee.io/blogs/2019/06/12/81770652.html/">Ubuntu18 è¸©å‘è®°å½• - nojsja/blogs â¤ï¸ nojsja/blogs</a></li></ul><h2 id="Final">Final</h2><blockquote><p>ç»“è¯­</p></blockquote><p>è¿™æ˜¯å®Œæ•´åšè¿‡çš„ç¬¬å››ä¸ª Electron é¡¹ç›®äº†ï¼Œç¬¬ä¸€ä¸ªæ˜¯ Ubuntu ç”µè„‘ç®¡å®¶ï¼Œç¬¬äºŒä¸ªæ˜¯å…¬å¸é¡¹ç›®ï¼šä¸€ä¸ªç±»ä¼¼ç™¾åº¦ç½‘ç›˜é‡‡ç”¨ SMB åè®®æ”¯æŒçš„æ–‡ä»¶ç®¡ç†å™¨ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ <code>electron-re</code> è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œæœ€åä¸€ä¸ªå°±æ˜¯è¿™æ¬¡çš„ <code>shadowsocks-electron</code> è·¨å¹³å° proxy å·¥å…·äº†ã€‚</p><p>å®¢æˆ·ç«¯ç›®å‰å·²ç»å‘å¸ƒäº† <code>v1.0.0</code> ç‰ˆæœ¬ï¼Œæ”¯æŒ <strong>Mac</strong> å’Œ <strong>Ubuntu</strong> x64 å¹³å°ï¼Œä¸»è¦æµ‹è¯•ç¯å¢ƒæ˜¯ï¼š<strong>Ubuntu20.04 amd64</strong> å’Œ <strong>MacOS catalina x64</strong>ã€‚</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" lazyload data-loading="img/loading.gif" data-src="https://nojsja.gitee.io/static-resources/images/shadowsocks/release.png" alt="release"></p><p>åæœŸä¼šæŒç»­æ”¯æŒï¼Œå–œæ¬¢çš„è¯å¯ä»¥å» <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/nojsja/shadowsocks-electron">github ä»“åº“</a> star â­ ï¼</p><p>è¿‘æœŸæœ‰è¿™äº›æƒ³å®Œå–„çš„åŠŸèƒ½ï¼š</p><ul><li>è€ƒè™‘æ”¯æŒ HTTP Proxyã€‚</li><li>è€ƒè™‘æ”¯æŒ SSR æœåŠ¡å™¨è¿æ¥ã€‚</li><li>ä¿®å¤äºŒç»´ç å¯¼å…¥åŠŸèƒ½ä¸­é®ç½©å±‚çª—å£å†…éƒ¨äºŒç»´ç é«˜äº®åŒºåŸŸä½ç½®ä¸å‡†ç¡®çš„é—®é¢˜(ç”±ç³»ç»ŸçŠ¶æ€æ å¯¼è‡´)ï¼Œå¹¶é€‚é…å¤šå±å¹•ã€‚</li><li>å¾ˆæƒ³æ”¯æŒæœåŠ¡å™¨å»¶è¿Ÿæ£€æµ‹å’Œè¿æ¥é€Ÿåº¦æµ‹è¯•åŠŸèƒ½ï¼Œæ„Ÿè§‰ä¼šå¾ˆç‚«ã€‚</li><li><code>v2ray</code> çš„è¯å…¶å®å·²ç»ä»¥æ’ä»¶çš„å½¢å¼æ”¯æŒäº†ï¼Œä¸è¿‡ç›®å‰æ²¡æœ‰è¯¦ç»†æµ‹è¯•è¿‡è¿™ä¸€åŠŸèƒ½ï¼Œè€ƒè™‘å¦‚æœ‰å¿…è¦åé¢ä¼šç›´æ¥æ”¯æŒè§£æ <code>v2ray</code> åŠ å¯†é“¾æ¥ã€‚</li></ul><p>æš‚æ—¶åªè€ƒè™‘ä¸º <strong>Mac/Ubuntu</strong> é€‚é…ï¼Œ<strong>Win</strong> å¹³å°çš„è¯å·¥å…·å¾ˆå¤šï¼ŒShadowsocks å®˜æ–¹ä¹Ÿæœ‰ä¸€ç›´åœ¨ç»´æŠ¤çš„å®¢æˆ·ç«¯ï¼Œç”¨èµ·æ¥éƒ½å¾ˆèˆ’æœã€‚</p><p>æ€»ä¹‹å­¦åˆ°äº†æ–°ä¸œè¥¿ï¼Œæœ€æŠ˜ç£¨äººçš„åœ°æ–¹å…¶å®æ˜¯æŠ˜è…¾ Mac è™šæ‹Ÿæœºï¼Œè¸©äº†å¾ˆå¤šå‘ï¼Œä»¥åæˆ‘è¿˜æ˜¯ç»§ç»­ç”¨æˆ‘çš„ <strong>Ubuntu/Win</strong> åŒç³»ç»Ÿå§ ~ ğŸ˜‚</p><span class="meta" id="headerViewCountWrapper"><span id="<Your/Path/Name>" class="leancloud_visitors" data-flag-title="Your Article Title"><em class="post-meta-item-text">â‡¸â‡¸ é˜…è¯»é‡ï¼š</em> <i class="leancloud-visitors-count">[ loading ]</i>â‡·â‡·</span></span><script>document.querySelector("#headerViewCountWrapper > .leancloud_visitors").id=decodeURIComponent(window.location.pathname)</script><hr style="margin-top:5px"><ul class="pager"><li class="previous"><a href="/2021/11/29/adb1f235.html/" data-toggle="tooltip" data-placement="top" title="è®°ä¸€æ¬¡ React hooks ç»„ä»¶å¼€å‘å’Œä¼˜åŒ–è®°å½•">&larr; Previous Post</a></li><li class="next"><a href="/2021/07/08/671354ab.html/" data-toggle="tooltip" data-placement="top" title="taroå°ç¨‹åºå¼€å‘ç¬”è®°">Next Post &rarr;</a></li></ul><style type="text/css">.aplayer-container{text-align:center}.lds-roller-loading{display:inline-block;position:relative;width:80px;height:80px}.lds-roller-loading div{animation:lds-roller 1.2s cubic-bezier(.5,0,.5,1) infinite;transform-origin:40px 40px}.lds-roller-loading div:after{content:" ";display:block;position:absolute;width:7px;height:7px;border-radius:50%;background:#ff59ac;margin:-4px 0 0 -4px}.lds-roller-loading div:nth-child(1){animation-delay:-36ms}.lds-roller-loading div:nth-child(1):after{top:63px;left:63px}.lds-roller-loading div:nth-child(2){animation-delay:-72ms}.lds-roller-loading div:nth-child(2):after{top:68px;left:56px}.lds-roller-loading div:nth-child(3){animation-delay:-108ms}.lds-roller-loading div:nth-child(3):after{top:71px;left:48px}.lds-roller-loading div:nth-child(4){animation-delay:-144ms}.lds-roller-loading div:nth-child(4):after{top:72px;left:40px}.lds-roller-loading div:nth-child(5){animation-delay:-.18s}.lds-roller-loading div:nth-child(5):after{top:71px;left:32px}.lds-roller-loading div:nth-child(6){animation-delay:-216ms}.lds-roller-loading div:nth-child(6):after{top:68px;left:24px}.lds-roller-loading div:nth-child(7){animation-delay:-252ms}.lds-roller-loading div:nth-child(7):after{top:63px;left:17px}.lds-roller-loading div:nth-child(8){animation-delay:-288ms}.lds-roller-loading div:nth-child(8):after{top:56px;left:12px}@keyframes lds-roller{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.aplayer .aplayer-pic .aplayer-pause svg{top:0;left:0}.aplayer .aplayer-pic .aplayer-play svg{top:0;left:2px}</style><div class="aplayer-container"><div id="aplayer" class="lds-roller-loading" lazy-css-href="https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.css" lazy-js-src="https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.js"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><script>(function(){var e,t=document.querySelector("#aplayer"),s=function(s,i){var r=[];s&&r.push(s),i&&r.push(i),r.forEach((function(s){async(s,(function(){/^.*.js$/.test(s)&&function(){e&&e.disconnect(),t.className="",t.innerHTML="";new APlayer({container:document.getElementById("aplayer"),theme:"#e9e9e9",audio:[{name:"å­˜åœ¨ä¿¡å·",artist:"AcuticNotes",url:"http://nojsja.gitee.io/static-resources/audio/life-signal.mp3",cover:"http://nojsja.gitee.io/static-resources/audio/life-signal.jpg"},{name:"éºã‚µãƒ¬ã‚¿å ´æ‰€ï¼æ–œå…‰",artist:"å²¡éƒ¨å•“ä¸€",url:"http://nojsja.gitee.io/static-resources/audio/%E6%96%9C%E5%85%89.mp3",cover:"http://nojsja.gitee.io/static-resources/audio/%E6%96%9C%E5%85%89.jpg"}]})}()}),/^.*.css$/.test(s)?"link":"script")}))};if(window.IntersectionObserver)(e=new IntersectionObserver((function(t){t.forEach((function(t){if(t.isIntersecting){e.unobserve(t.target);var i=t.target.getAttribute("lazy-css-href"),r=t.target.getAttribute("lazy-js-src");s(i,r)}}))}))).observe(t);else{var i=t.getAttribute("lazy-css-href"),r=t.getAttribute("lazy-js-src");s(i,r)}}).bind(window)()</script><hr><div id="vcomments"></div><script>(function(){function e(){async("js/Valine.min.js",(function(){new Valine({el:"#vcomments",appId:"wUKKBx8BRzGaNfhgdg2UKtub-MdYXbMMI",appKey:"MAwYM4KlW5YJ3q06qwnUScBr",visitor:!0})}))}if(window.IntersectionObserver){var n=new IntersectionObserver((function(i){i.forEach((function(i){i.isIntersecting&&(n.unobserve(i.target),n.disconnect(),e())}))}));n.observe(document.querySelector("#headerViewCountWrapper"))}else e()}).bind(window)()</script></div><aside id="sidebar"><div id="toc" class="toc-article"><strong class="toc-title">Contents</strong><ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Preface"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">Preface</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Prevew"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">Prevew</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Contents"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">Contents</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Tools-Technology"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">Tools &amp; Technology</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-%E4%BD%8E%E9%85%8D%E7%BD%AE%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%EF%BC%9Areact-app-rewired"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">1. ä½é…ç½®å¿«é€Ÿå¯åŠ¨å‰ç«¯å¼€å‘ç¯å¢ƒï¼šreact-app-rewired</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-%E4%BB%A3%E7%A0%81%E6%9B%B4%E6%94%B9%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%EF%BC%9Anodemon"><span class="toc-nav-number">4.2.</span> <span class="toc-nav-text">2. ä»£ç æ›´æ”¹è‡ªåŠ¨é‡å¯ï¼šnodemon</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%9Aredux-persist-redux-persist-electron-storage"><span class="toc-nav-number">4.3.</span> <span class="toc-nav-text">3. æ•°æ®æŒä¹…åŒ–ï¼šredux-persist&#x2F;redux-persist-electron-storage</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4-%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%EF%BC%9Aelectron-builder"><span class="toc-nav-number">4.4.</span> <span class="toc-nav-text">4. é¡¹ç›®æ‰“åŒ…ï¼šelectron-builder</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#5-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%90%E8%A1%8C%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86%EF%BC%9Awinston"><span class="toc-nav-number">4.5.</span> <span class="toc-nav-text">5. å®¢æˆ·ç«¯è¿è¡Œæ—¥å¿—ç®¡ç†ï¼šwinston</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Core-Functions"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">Core Functions</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-%E8%A7%A3%E6%9E%90-Shadowsocks-%E4%B8%93%E7%94%A8%E5%8A%A0%E5%AF%86%E9%93%BE%E6%8E%A5"><span class="toc-nav-number">5.1.</span> <span class="toc-nav-text">1. è§£æ Shadowsocks ä¸“ç”¨åŠ å¯†é“¾æ¥</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-%E5%B0%86%E5%B7%B2%E6%9C%89%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%9B%BE%E7%89%87%E8%BF%9B%E8%A1%8C%E5%88%86%E4%BA%AB"><span class="toc-nav-number">5.2.</span> <span class="toc-nav-text">2. å°†å·²æœ‰çš„æœåŠ¡å™¨é…ç½®ç”ŸæˆäºŒç»´ç å›¾ç‰‡è¿›è¡Œåˆ†äº«</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-%E8%AF%BB%E5%8F%96%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%AF%BC%E5%85%A5-Shadowsocks-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-nav-number">5.3.</span> <span class="toc-nav-text">3. è¯»å–äºŒç»´ç å¯¼å…¥ Shadowsocks æœåŠ¡å™¨é…ç½®</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4-%E5%A4%9A%E5%B9%B3%E5%8F%B0%E5%8A%9F%E8%83%BD%E9%80%82%E9%85%8D%E4%B9%8B-shadowsocks-libev-%E5%BA%93%E7%9A%84%E4%BE%9D%E8%B5%96%E5%A4%84%E7%90%86"><span class="toc-nav-number">5.4.</span> <span class="toc-nav-text">4. å¤šå¹³å°åŠŸèƒ½é€‚é…ä¹‹ shadowsocks-libev åº“çš„ä¾èµ–å¤„ç†</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#5-Electron-%E8%B0%83%E7%94%A8-shadowsocks-libev-%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-nav-number">5.5.</span> <span class="toc-nav-text">5. Electron è°ƒç”¨ shadowsocks-libev åº“è¿æ¥æœåŠ¡å™¨</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#6-%E5%A4%9A%E5%B9%B3%E5%8F%B0%E5%8A%9F%E8%83%BD%E9%80%82%E9%85%8D%E4%B9%8B%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9F-proxy-%E5%92%8C-pac-%E6%9C%8D%E5%8A%A1"><span class="toc-nav-number">5.6.</span> <span class="toc-nav-text">6. å¤šå¹³å°åŠŸèƒ½é€‚é…ä¹‹è®¾ç½®ç³»ç»Ÿ proxy å’Œ pac æœåŠ¡</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9F-proxy"><span class="toc-nav-number">5.6.1.</span> <span class="toc-nav-text">è®¾ç½®ç³»ç»Ÿ proxy</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9F-pac-%E6%96%87%E4%BB%B6%E5%9C%B0%E5%9D%80"><span class="toc-nav-number">5.6.2.</span> <span class="toc-nav-text">è®¾ç½®ç³»ç»Ÿ pac æ–‡ä»¶åœ°å€</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#7-%E5%A4%9A%E5%B9%B3%E5%8F%B0%E5%8A%9F%E8%83%BD%E9%80%82%E9%85%8D%E4%B9%8B%E5%BA%94%E7%94%A8%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8"><span class="toc-nav-number">5.7.</span> <span class="toc-nav-text">7. å¤šå¹³å°åŠŸèƒ½é€‚é…ä¹‹åº”ç”¨å¼€æœºè‡ªå¯åŠ¨</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#8-%E4%BD%BF%E7%94%A8-Electron-%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E5%99%A8%E6%8F%90%E9%AB%98%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95%E6%95%88%E7%8E%87"><span class="toc-nav-number">5.8.</span> <span class="toc-nav-text">8. ä½¿ç”¨ Electron è¿›ç¨‹ç®¡ç†å™¨æé«˜å¼€å‘è°ƒè¯•æ•ˆç‡</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Others"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">Others</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-Mac-%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9C%9F%E6%98%AF%E9%9A%BE%E8%A3%85"><span class="toc-nav-number">6.1.</span> <span class="toc-nav-text">1. Mac è™šæ‹ŸæœºçœŸæ˜¯éš¾è£…</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-Mac-brew-%E5%9C%A8%E5%9B%BD%E5%86%85%E7%8E%AF%E5%A2%83%E7%9A%84%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F"><span class="toc-nav-number">6.2.</span> <span class="toc-nav-text">2. Mac brew åœ¨å›½å†…ç¯å¢ƒçš„å®‰è£…æ–¹å¼</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-Node-js-child-process-%E6%89%A7%E8%A1%8C%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91"><span class="toc-nav-number">6.3.</span> <span class="toc-nav-text">3. Node.js child_process æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸€äº›å‘</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4-%E6%80%8E%E6%A0%B7%E4%B8%BA%E6%9C%AA%E9%80%82%E9%85%8D-Typescript-%E7%9A%84%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85%E7%BC%96%E5%86%99-types-%E5%A3%B0%E6%98%8E"><span class="toc-nav-number">6.4.</span> <span class="toc-nav-text">4. æ€æ ·ä¸ºæœªé€‚é… Typescript çš„ç¬¬ä¸‰æ–¹åŒ…ç¼–å†™ @types å£°æ˜</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#5-%E6%84%9F%E8%B0%A2%E4%BD%9C%E4%B8%BA-UI-%E8%AE%BE%E8%AE%A1%E5%B8%88%E7%9A%84-GF-%E5%80%BE%E6%83%85%E6%94%AF%E6%8C%81"><span class="toc-nav-number">6.5.</span> <span class="toc-nav-text">5. æ„Ÿè°¢ä½œä¸º UI è®¾è®¡å¸ˆçš„ GF å€¾æƒ…æ”¯æŒ</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#6-%E5%BB%B6%E4%BC%B8%E9%98%85%E8%AF%BB"><span class="toc-nav-number">6.6.</span> <span class="toc-nav-text">6. å»¶ä¼¸é˜…è¯»</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Final"><span class="toc-nav-number">7.</span> <span class="toc-nav-text">Final</span></a></li></ol></div></aside></div></div></article><script>async("https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js",(function(){anchors.options={visible:"hover",placement:"left",icon:"â„¬"},anchors.add().remove(".intro-header h1").remove(".subheading").remove(".sidebar-container h5")}))</script><script src="https://lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><script type="text/javascript" src="js/anchor.nojsja.js"></script><style>#websiteModal .modal-body{display:flex;align-items:center;justify-content:center;margin:auto;text-align:center;width:100%;height:100%}#websiteModal .modal-body img{max-width:100%;height:auto}</style><script>$(document).ready((function(){$(document).on("click","img",(function(o){if($(this).hasClass("click-disable"))o&&o.stopPropagation();else{o&&o.stopPropagation();var a=$(this).clone();$("#websiteModal").modal("show"),a.addClass("click-disable"),$("#websiteModal .modal-body").html(a)}})).on("click",".modal-body",(function(){$("#websiteModal").modal("hide")}))}))</script><div class="modal fade" id="websiteModal" tabindex="-1" role="dialog" aria-labelledby="websiteModalTitle" aria-hidden="true"><div class="modal-body"></div></div><footer><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/nojsja"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; nojsja 2022</p></div></div></div></footer><script src="https://lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><script src="https://cdn.usebootstrap.com/bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/js/widgets.js"></script><script>async("https://nojsja.gitee.io/static-resources/libs/fastclick/1.0.6/fastclick.min.js",(function(){var t=document.querySelector("nav");t&&FastClick.attach(t)}))</script><script type="text/javascript">var search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path;searchFunc(path,"local-search-input","local-search-result")</script><script src="/js/busuanzi.pure.mini.js" defer async></script><a id="rocket" href="#top"></a><script type="text/javascript" src="js/totop.js" async></script><script>(function(){function t(t){return document.querySelectorAll(t)}if(window.hexoLoadingImages=window.hexoLoadingImages||{},window.IntersectionObserver){var e=new IntersectionObserver((function(t){t.forEach((function(t){if(t.isIntersecting){e.unobserve(t.target);var n=new Image,o="_img_"+Math.random();window.hexoLoadingImages[o]=n,n.onload=function(){t.target.src=t.target.getAttribute("data-src"),window.hexoLoadingImages[o]=null},n.onerror=function(){window.hexoLoadingImages[o]=null},t.target.src=t.target.getAttribute("data-loading"),n.src=t.target.getAttribute("data-src")}}))}));t("img[lazyload]").forEach((function(t){e.observe(t)}))}else t("img[lazyload]").forEach((function(t){t.src=t.getAttribute("data-src")}))}).bind(window)()</script></body></html>